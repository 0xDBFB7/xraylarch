

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>13. X-ray Fluorescence Analysis with Larch &#8212; larch 0.9.46 documentation</title>
    <link rel="stylesheet" href="../_static/larchdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="14. Programming with Larch from Python" href="../devel/index.html" />
    <link rel="prev" title="12. X-ray Databases" href="../xray/index.html" />
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({ "TeX": {Macros: {AA : "{\\unicode{x212B}}"}},
			 "HTML-CSS": {scale: 90}});
  </script>

  </head><body>
<div style=" color: #c5daba;  text-align: left; height:65px; padding: 0px">
<table border=0>
  <tr>
    <td width=20%>
	<a href="../index.html">
	 <img src="../_static/larchcones.png" height=50px alt="larchcones"/></a>
    </td>
    <td width=75% padding=0>
      <font size=+2>
	<a href="../index.html" style="color:#772211">
	  Larch: Data Analysis Tools for X-ray Spectroscopy
	</a>
      </font>
    </td>
   </tr></table>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../devel/index.html" title="14. Programming with Larch from Python"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../xray/index.html" title="12. X-ray Databases"
             accesskey="P">previous</a> |</li>
   <li>[<a href="../index.html"> Larch</a>|</li>
   <li><a href="../getting_started.html"> Getting Started</a>|</li>
   <li><a href="../xafs/index.html">XAFS Analysis</a>|</li>
   <li><a href="../xray/index.html">X-ray Databases</a>|</li>
   <li><a href="#">XRF Analysis</a>|</li>
   <li><a href="../fitting/index.html">Curve Fitting</a>|</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">13. X-ray Fluorescence Analysis with Larch</a><ul>
<li><a class="reference internal" href="#mca-and-roi-objects">13.1. MCA and ROI objects</a></li>
<li><a class="reference internal" href="#creating-mca-objects">13.2. Creating MCA objects</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../xray/index.html"
                        title="previous chapter">12. X-ray Databases</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../devel/index.html"
                        title="next chapter">14. Programming with Larch from Python</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/xrf/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="x-ray-fluorescence-analysis-with-larch">
<h1>13. X-ray Fluorescence Analysis with Larch<a class="headerlink" href="#x-ray-fluorescence-analysis-with-larch" title="Permalink to this headline">¶</a></h1>
<p>X-ray Fluorescence Data can be manipulated and displayed with
Larch. Some tools for XRF analysis, to convert XRF spectra into elemental
concentrations, are also available and more are being added.   A work in
progress, this chapter discusses some of the existing tools.</p>
<div class="section" id="mca-and-roi-objects">
<h2>13.1. MCA and ROI objects<a class="headerlink" href="#mca-and-roi-objects" title="Permalink to this headline">¶</a></h2>
<p>Traditionally, XRF spectra have been measured with MCAs (Multi Channel
Analyzers) which holds an array of intensities.  Because of this history,
the two concepts are often mixed, and one often talks about MCA traces as
being the same as XRF spectra.  To be sure, an XRF spectrum <span class="math notranslate nohighlight">\(I(E)\)</span>
can be represented well with an MCA trace (intensities per bin) as long as
one can convert bin number to energy.  Fortunately, most measurement
systems in use have a linear relation (calibration) between bin number and
energy, and the use of an MCA trace as an XRF spectrum is straightforward.
We will probably use the terms interchangeably here as well.</p>
<p>To be clear, an XRF spectrum collected by an MCA will have a one
dimensional array of intensities (or counts, as detectors typically count
X-rays the numbers are small enough to highlight the difference) with a
single, well-defined energy for each bin.  There will typically be between
1000 and 10,000 bins in each spectrum.</p>
<p>An ROI (Region of Interest) is a continuous portion of the XRF spectrum,
generally representing a range of energies corresponding to a particular
peak or X-ray emission line or family of lines.   One often sums the counts
in such an ROI to give a total number of counts for that emission line.  An
MCA spectrum may have many (typically 10s) of ROIs defined for particular
emission lines.</p>
<p>In Larch, MCAs and ROIs are exposed as Groups, each with several
attributes, and some built-in functions.  For example, An MCA has arrays
for <code class="docutils literal notranslate"><span class="pre">energy</span></code> and <code class="docutils literal notranslate"><span class="pre">counts</span></code>, as well as values for <code class="docutils literal notranslate"><span class="pre">real_time</span></code> and
<code class="docutils literal notranslate"><span class="pre">live_time</span></code>, a deadtime correction factor <code class="docutils literal notranslate"><span class="pre">dt_factor</span></code>, and several
ROIs.  Each ROI has a <code class="docutils literal notranslate"><span class="pre">left</span></code> and <code class="docutils literal notranslate"><span class="pre">right</span></code> channel index, and a
<code class="xref py py-meth docutils literal notranslate"><span class="pre">roi.get_counts()</span></code> method.</p>
</div>
<div class="section" id="creating-mca-objects">
<h2>13.2. Creating MCA objects<a class="headerlink" href="#creating-mca-objects" title="Permalink to this headline">¶</a></h2>
<p>A simple way to create an MCA object is to read one from a disk file.  For
data collected at GSECARS, this can be done with the <a class="reference internal" href="#read_gsemca" title="read_gsemca"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_gsemca()</span></code></a>
function.</p>
<dl class="function">
<dt id="read_gsemca">
<code class="sig-name descname">read_gsemca</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#read_gsemca" title="Permalink to this definition">¶</a></dt>
<dd><p>read a GSECARS MCA spectra file, returning a Group</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> – name of GSECARS MCA file</p>
</dd>
</dl>
<p>The returned Group has the following components:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>component name</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>filename</p></td>
<td><p>name of file</p></td>
</tr>
<tr class="row-odd"><td><p>mcas</p></td>
<td><p>list of MCA objects for each MCA saved in the file</p></td>
</tr>
<tr class="row-even"><td><p>rois</p></td>
<td><p>list of ROIs</p></td>
</tr>
<tr class="row-odd"><td><p>environ</p></td>
<td><p>list of Environmental Variables</p></td>
</tr>
<tr class="row-even"><td><p>energy</p></td>
<td><p>array of energy values</p></td>
</tr>
<tr class="row-odd"><td><p>counts</p></td>
<td><p>array of counts, deadtime corrected and summed over MCAs</p></td>
</tr>
<tr class="row-even"><td><p>raw</p></td>
<td><p>array of counts, summed over MCAs, not corrected.</p></td>
</tr>
<tr class="row-odd"><td><p>calib</p></td>
<td><p>dictionary of calibration values</p></td>
</tr>
<tr class="row-even"><td><p>dt_factor</p></td>
<td><p>deadtime correction factor</p></td>
</tr>
<tr class="row-odd"><td><p>real_time</p></td>
<td><p>real time for data acquisition</p></td>
</tr>
<tr class="row-even"><td><p>live_time</p></td>
<td><p>live time for data acquisition</p></td>
</tr>
<tr class="row-odd"><td><p>nchans</p></td>
<td><p>number of energy points in spectra</p></td>
</tr>
<tr class="row-even"><td><p>get_roi_counts()</p></td>
<td><p>function to get counts for a named ROI</p></td>
</tr>
<tr class="row-odd"><td><p>save_mcafile()</p></td>
<td><p>function to save MCA to file</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="xrf_plot">
<code class="sig-name descname">xrf_plot</code><span class="sig-paren">(</span><em class="sig-param">energy</em>, <em class="sig-param">counts</em>, <em class="sig-param">mca=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xrf_plot" title="Permalink to this definition">¶</a></dt>
<dd><p>create an interactive window for displaying an X-ray Fluorescence spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>energy</strong> – array of energy values</p></li>
<li><p><strong>counts</strong> – array of counts</p></li>
<li><p><strong>mca</strong> – MCA group (as read from <a class="reference internal" href="#read_gsemca" title="read_gsemca"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_gsemca()</span></code></a>), containing
ROI definitions, calibration values, and related data.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>An example plot is shown below</p>
<div class="figure align-default" id="id1">
<span id="xrf-fig1"></span><a class="reference external image-reference" href="../_images/xrf_display1.png"><img alt="../_images/xrf_display1.png" src="../_images/xrf_display1.png" style="width: 75%;" /></a>
<p class="caption"><span class="caption-number">Figure 13.2.1 </span><span class="caption-text">Example XRF Display, showing X-ray Fluorescence spectra, defined ROIs
(in red), and Periodic Table for showing predicted emission lines.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../devel/index.html" title="14. Programming with Larch from Python"
             >next</a> |</li>
        <li class="right" >
          <a href="../xray/index.html" title="12. X-ray Databases"
             >previous</a> |</li>
   <li>[<a href="../index.html"> Larch</a>|</li>
   <li><a href="../getting_started.html"> Getting Started</a>|</li>
   <li><a href="../xafs/index.html">XAFS Analysis</a>|</li>
   <li><a href="../xray/index.html">X-ray Databases</a>|</li>
   <li><a href="#">XRF Analysis</a>|</li>
   <li><a href="../fitting/index.html">Curve Fitting</a>|</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright Matthew Newville, The University of Chicago, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>