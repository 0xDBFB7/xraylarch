

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>XAFS: Fitting XAFS to Feff Paths &mdash; larch 0.9.16 documentation</title>
    
    <link rel="stylesheet" href="../_static/larchdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.16',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="larch 0.9.16 documentation" href="../index.html" />
    <link rel="up" title="XAFS Analysis" href="index.html" />
    <link rel="next" title="X-ray Databases" href="../xray/index.html" />
    <link rel="prev" title="XAFS: Reading and using Feff Paths" href="feffpaths.html" /> 
  </head>
  <body>
<div style=" color: #c5daba;  text-align: left;
            height:100px; padding: 0">
<table><tr>
  <td width=20% padding=0>
    <a href="#">
       <img src="../_static/larchcones.png" width=90% alt="larchcones"/>
    </a>
  </td><td width=80% padding=0>
      <font size=+3><a href="../index.html" style="color: #772211">
          Larch: X-ray Data Analysis   </a></font>
</td></tr></table>
</div>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../xray/index.html" title="X-ray Databases"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="feffpaths.html" title="XAFS: Reading and using Feff Paths"
             accesskey="P">previous</a> |</li>
   <li><a href="../contents.html">contents</a>|&nbsp;</li>
   <li><a href="../installation.html">download</a>|&nbsp;</li>
   <li><a href="../tutorial/index.html">tutorial</a>|&nbsp;</li>
   <li><a href="../plotting/index.html">plot</a>|&nbsp;</li>
   <li><a href="../fitting/index.html">fit</a>|&nbsp;</li>
   <li><a href="index.html">XAFS</a>|&nbsp;</li>
   <li><a href="../xray/index.html">Xray Data</a>|&nbsp;</li>
   <li><a href="../xray/xrf.html">XRF</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">XAFS Analysis</a> &raquo;</li> 
      </ul>
    </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">XAFS: Fitting XAFS to Feff Paths</a><ul>
<li><a class="reference internal" href="#feffit-transform"><tt class="docutils literal"><span class="pre">feffit_transform()</span></tt></a></li>
<li><a class="reference internal" href="#feffit-dataset"><tt class="docutils literal"><span class="pre">feffit_dataset()</span></tt></a></li>
<li><a class="reference internal" href="#feffit"><tt class="docutils literal"><span class="pre">feffit()</span></tt></a></li>
<li><a class="reference internal" href="#feffit-report"><tt class="docutils literal"><span class="pre">feffit_report()</span></tt></a></li>
<li><a class="reference internal" href="#example-1-simple-fit-with-1-path">Example 1: Simple fit with 1 Path</a></li>
<li><a class="reference internal" href="#example-2-fit-1-dataset-with-3-paths">Example 2: Fit 1 dataset with 3 Paths</a></li>
<li><a class="reference internal" href="#example-3-fit-3-datasets-with-3-paths-each">Example 3: Fit 3 datasets with 3 Paths each</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="feffpaths.html"
                        title="previous chapter">XAFS: Reading and using Feff Paths</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../xray/index.html"
                        title="next chapter">X-ray Databases</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/xafs/feffit.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-_xafs">
<span id="xafs-fitting-xafs-to-feff-paths"></span><h1>XAFS: Fitting XAFS to Feff Paths<a class="headerlink" href="#module-_xafs" title="Permalink to this headline">Â¶</a></h1>
<p>Fitting XAFS data with structural models based on Feff calculations is a
primary motivation for Larch.  In this section, we describe how to set up a
fitting model to fit a set of FEFF calculations to XAFS data.  Many parts
of the documentation so far have touched on important aspects of this
process, and those sections will be referenced here.</p>
<p>The basic approach is to create a model EXAFS <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/> as a sum of
scattering paths that will be compared to experimentally derived
<img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/>.  The model will be parameterized in terms of Larch
Parameters defined by <a class="reference internal" href="../fitting/parameters.html#_math.param" title="_math.param"><tt class="xref py py-func docutils literal"><span class="pre">_math.param()</span></tt></a>.  A fit, using the same fitting
infrastructure as to <a class="reference internal" href="../fitting/minimize.html#_math.minimize" title="_math.minimize"><tt class="xref py py-func docutils literal"><span class="pre">_math.minimize()</span></tt></a> will be used to refine the
values of the variable parameters in the model.  To be clear, the Path
Parameters for all Feff Paths in the fits should be written in terms of
variable parameters help in a single parameter group.  The refinement will
be done by comparing the model and experimental <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/> after a
<em>Transformation</em> based on the Fourier transforms in <a class="reference internal" href="xafsft.html#xafs-ft-sec"><em>XAFS: Fourier Transforms for XAFS</em></a>.</p>
<p>The function <a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a> is the principle function to do the fit of a
set of Feff paths to XAFS spectra.  This essentially runs
<a class="reference internal" href="../fitting/minimize.html#_math.minimize" title="_math.minimize"><tt class="xref py py-func docutils literal"><span class="pre">_math.minimize()</span></tt></a> with a parameter group, but with a built-in
objective function to calculate the fit residual.  This built-in objective
function calculates the residual as the difference of model and
experimental <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/> for a list of <em>Datasets</em>.  Here, a <em>Feffit
Dataset</em> is an important concept that will allow us to easily extend
modeling to multiple data sets.</p>
<p>A <em>Feffit Dataset</em> has three principle components.  First, it has an
experimental data, <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/>.  Second, it has a list of Feff paths &#8211;
<a class="reference internal" href="feffpaths.html#_xafs.ff2chi" title="_xafs.ff2chi"><tt class="xref py py-func docutils literal"><span class="pre">ff2chi()</span></tt></a> will be used to calculate the model <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/>.  Third,
it has a <em>Feffit Transform</em> group which holds the Fourier transform and
fitting ranges to select how the data and model are to be compared.  In
addition, a fit has a single parameter group, holding all the variable and
constrained parameters used by all the paths and data sets in a fit.</p>
<p>There are then 3 principle functions for setting up and executing
<a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="#_xafs.feffit_transform" title="_xafs.feffit_transform"><tt class="xref py py-func docutils literal"><span class="pre">feffit_transform()</span></tt></a> is used to create a Transform group,
which holds the set of Fourier transform parameters.</li>
<li><a class="reference internal" href="#_xafs.feffit_dataset" title="_xafs.feffit_dataset"><tt class="xref py py-func docutils literal"><span class="pre">feffit_dataset()</span></tt></a> is used to create a Dataset group, which
consists of the three components described above:<ol class="loweralpha">
<li>a group holding experimental data (<tt class="docutils literal"><span class="pre">k</span></tt> and <tt class="docutils literal"><span class="pre">chi</span></tt>).</li>
<li>a list of Feff paths.</li>
<li>a Transform group.</li>
</ol>
</li>
<li>Finally, <a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a> is run with a parameter group containing
the variable and constrained Parameters for the fit, and a dataset
or list of datasets groups.</li>
</ol>
</div></blockquote>
<div class="section" id="feffit-transform">
<h2><a class="reference internal" href="#_xafs.feffit_transform" title="_xafs.feffit_transform"><tt class="xref py py-func docutils literal"><span class="pre">feffit_transform()</span></tt></a><a class="headerlink" href="#feffit-transform" title="Permalink to this headline">Â¶</a></h2>
<dl class="function">
<dt id="_xafs.feffit_transform">
<tt class="descclassname">_xafs.</tt><tt class="descname">feffit_transform</tt><big>(</big><em>fitspace='r'</em>, <em>kmin=0</em>, <em>kmax=20</em>, <em>kweight=2</em>, <em>...</em><big>)</big><a class="headerlink" href="#_xafs.feffit_transform" title="Permalink to this definition">Â¶</a></dt>
<dd><p>create and return Feffit Transform group to be used in a Feffit dataset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fitspace</strong> &#8211; name of FT type for fit  (&#8216;r&#8217;).</li>
<li><strong>kmin</strong> &#8211; starting <em>k</em> for FT Window (0).</li>
<li><strong>kmax</strong> &#8211; ending <em>k</em> for FT Window (20).</li>
<li><strong>dk</strong> &#8211; tapering parameter for FT Window (4).</li>
<li><strong>dk2</strong> &#8211; second tapering parameter for FT Window (None).</li>
<li><strong>window</strong> &#8211; name of window type (&#8216;kaiser&#8217;).</li>
<li><strong>nfft</strong> &#8211; value to use for <img class="math" src="../_images/math/182d1a26e1047e88dbb946be3bebe76d50f01a60.png" alt="N_{\rm fft}"/> (2048).</li>
<li><strong>kstep</strong> &#8211; value to use for <img class="math" src="../_images/math/fbdfd51d57bb2c9ba22c27cbd408d65200d28f70.png" alt="\delta{k}"/> (0.05).</li>
<li><strong>kweight</strong> &#8211; exponent for weighting spectra by <img class="math" src="../_images/math/351cfe295a9c1727c0af7a2d3e2cb31984cd439b.png" alt="k^{\rm kweight}"/> (2).</li>
<li><strong>rmin</strong> &#8211; starting <em>R</em> for Fit Range and/or reverse FT Window (0).</li>
<li><strong>rmax</strong> &#8211; ending <em>R</em> for Fit Range and/or reverse FT Window (10).</li>
<li><strong>dr</strong> &#8211; tapering parameter for reverse FT Window 0.</li>
<li><strong>rwindow</strong> &#8211; name of window type for reverse FT Window (&#8216;kaiser&#8217;).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Feffit Transform group</p>
</td>
</tr>
</tbody>
</table>
<p>The parameters stored in the returned group object will be used to
control how the fit is performed.</p>
</dd></dl>

</div>
<div class="section" id="feffit-dataset">
<h2><a class="reference internal" href="#_xafs.feffit_dataset" title="_xafs.feffit_dataset"><tt class="xref py py-func docutils literal"><span class="pre">feffit_dataset()</span></tt></a><a class="headerlink" href="#feffit-dataset" title="Permalink to this headline">Â¶</a></h2>
<dl class="function">
<dt id="_xafs.feffit_dataset">
<tt class="descclassname">_xafs.</tt><tt class="descname">feffit_dataset</tt><big>(</big><em>data=None</em>, <em>pathlist=</em><span class="optional">[</span><span class="optional">]</span>, <em>transform=None</em><big>)</big><a class="headerlink" href="#_xafs.feffit_dataset" title="Permalink to this definition">Â¶</a></dt>
<dd><p>create a Feffit Dataset group.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> &#8211; group containing experimental EXAFS (needs arrays <tt class="docutils literal"><span class="pre">k</span></tt> and <tt class="docutils literal"><span class="pre">chi</span></tt>).</li>
<li><strong>pathlis</strong> &#8211; list of FeffPath groups, as created from <a class="reference internal" href="feffpaths.html#_xafs.feffpath" title="_xafs.feffpath"><tt class="xref py py-func docutils literal"><span class="pre">feffpath()</span></tt></a>.</li>
<li><strong>transform</strong> &#8211; Feffit Transform group.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Feffit Dataset group.</p>
</td>
</tr>
</tbody>
</table>
<p>A Dataset group is pretty simple, initially consisting of <tt class="docutils literal"><span class="pre">data</span></tt>, a
<tt class="docutils literal"><span class="pre">pathlist</span></tt>, and a <tt class="docutils literal"><span class="pre">transform</span></tt>, though each of these can be complex.</p>
<p>The value for <tt class="docutils literal"><span class="pre">data</span></tt> must be a group containing arrays <tt class="docutils literal"><span class="pre">k</span></tt> and
<tt class="docutils literal"><span class="pre">chi</span></tt> (as determined <a class="reference internal" href="autobk.html#_xafs.autobk" title="_xafs.autobk"><tt class="xref py py-func docutils literal"><span class="pre">_xafs.autobk()</span></tt></a> or some other procedure).
If it contains a value (scalar or array) <tt class="docutils literal"><span class="pre">epsilon_k</span></tt>, that will be
used as the uncertainty in <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/> for weighting the fit.
Otherwise, the uncertainty in <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/> will be estimated
automatically.  The <tt class="docutils literal"><span class="pre">pathlist</span></tt> is a list of Feff Paths, each of which
can have its Path Parameters written in terms of fit parameters (see
the final example in the previous section).  This list of paths will be
sent to <a class="reference internal" href="feffpaths.html#_xafs.ff2chi" title="_xafs.ff2chi"><tt class="xref py py-func docutils literal"><span class="pre">ff2chi()</span></tt></a> to caclulate the model <img class="math" src="../_images/math/6dcb9b88aaa5f14312835145edf06fb2d0823c29.png" alt="\chi"/> to compare
to the experimental data.  Finally, <tt class="docutils literal"><span class="pre">transform</span></tt> is a Feffit transform
group, as defined above.</p>
</dd></dl>

</div>
<div class="section" id="feffit">
<h2><a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a><a class="headerlink" href="#feffit" title="Permalink to this headline">Â¶</a></h2>
<dl class="function">
<dt id="_xafs.feffit">
<tt class="descclassname">_xafs.</tt><tt class="descname">feffit</tt><big>(</big><em>paramgroup</em>, <em>datasets</em>, <em>rmax_out=10</em>, <em>path_outputs=True</em><big>)</big><a class="headerlink" href="#_xafs.feffit" title="Permalink to this definition">Â¶</a></dt>
<dd><p>execute a Feffit fit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>paramgroup</strong> &#8211; group containing parameters for fit</li>
<li><strong>datasets</strong> &#8211; Feffit Dataset group or list of Feffit Dataset group.</li>
<li><strong>rmax_out</strong> &#8211; maximum <img class="math" src="../_images/math/eff43e84f8a3bcf7b6965f0a3248bc4d3a9d0cd4.png" alt="R"/> value to calculate output arrays.</li>
<li><strong>path_output</strong> &#8211; Flag to set whether all Path outputs should be written.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a fit results group.</p>
</td>
</tr>
</tbody>
</table>
<p>The <tt class="docutils literal"><span class="pre">paramgroup</span></tt> is a group containing all fitting parameters for the
model.  The <tt class="docutils literal"><span class="pre">datasets</span></tt> argument can be either a single Feffit Dataset
as created by <a class="reference internal" href="#_xafs.feffit_dataset" title="_xafs.feffit_dataset"><tt class="xref py py-func docutils literal"><span class="pre">feffit_dataset()</span></tt></a> or a list of them.  If
<tt class="docutils literal"><span class="pre">path_outputs==True</span></tt>, all Feff Paths in the fit will be separately
Fourier transformed.</p>
<p>When the fit is completed, the returned value will be a group
containing three objects:</p>
<blockquote>
<div><ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">datasets</span></tt>: an array of FeffitDataSet groups used in the fit.</li>
<li><tt class="docutils literal"><span class="pre">params</span></tt>: This will be identical to the input parameter group.</li>
<li><tt class="docutils literal"><span class="pre">fit</span></tt>: an object which points to the low-level fit.</li>
</ol>
</div></blockquote>
<p>In addition, the output statistics listed below in <a class="reference internal" href="#xafs-feffit-stats-table"><em>Table of
Feffit Output Statistics</em></a>.  will be written
the <tt class="docutils literal"><span class="pre">paramgroup</span></tt> group.  Since each varied and constrained parameter
will also have best-values and estimated uncertainties, this allows the
parameter group to be considered the principle group for a particular
fit &#8211; it holds the variable parameters and statistical results needed
to compare two fits.</p>
<p>On output, a new sub-group called <tt class="docutils literal"><span class="pre">model</span></tt> will be created for each
Feffit Dataset. This will parallel the <tt class="docutils literal"><span class="pre">data</span></tt> group, in the sense
that it will have output arrays listed in the <a class="reference internal" href="#xafs-feffit-arrays-table"><em>Table of Feffit
Output Arrays</em></a>.</p>
<p>If <tt class="docutils literal"><span class="pre">path_outputs==True</span></tt>, all Feff Paths in the fit will be separately
Fourier transformed., with the result being put in the corresponding
FeffPath group.</p>
<p>A final note on the outputs of <a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a>: the <tt class="docutils literal"><span class="pre">param</span></tt> sub-group in
the output is truly identical to the input <tt class="docutils literal"><span class="pre">paramgroup</span></tt>.  It is not a
copy but points to the same group of values (see
<a class="reference internal" href="../tutorial/datatypes.html#tutor-objectids-sec"><em>Object identities, copying, and equality vs. identity</em></a>).</p>
</dd></dl>

<blockquote id="xafs-feffit-stats-table">
<span id="index-0"></span><div><p>Table of Feffit Output Statistics.  These values will be written to the
<tt class="docutils literal"><span class="pre">paramgroup</span></tt> group. Listed here are the group component name and a
description of its content.  Many of these are described in more detail
in <a class="reference internal" href="../fitting/results.html#fitting-results-sec"><em>Fit Results and Outputss</em></a></p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">component name</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>chi_reduced</td>
<td>reduced chi-square statistic.</td>
</tr>
<tr class="row-odd"><td>chi_square</td>
<td>chi-square statistic.</td>
</tr>
<tr class="row-even"><td>covar</td>
<td>covariance matrix.</td>
</tr>
<tr class="row-odd"><td>covar_vars</td>
<td>list of variable names for rows and colums of covariance matrix.</td>
</tr>
<tr class="row-even"><td>errorbars</td>
<td>Flag whether error bars could be calculated.</td>
</tr>
<tr class="row-odd"><td>fit_details</td>
<td>group with additional fit details.</td>
</tr>
<tr class="row-even"><td>message</td>
<td>output message from fit.</td>
</tr>
<tr class="row-odd"><td>nfree</td>
<td>number of degrees of freedom in fit.</td>
</tr>
<tr class="row-even"><td>nvarys</td>
<td>number of variables in fit.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
<blockquote id="xafs-feffit-arrays-table">
<span id="index-1"></span><div><p>Table of Feffit Output Arrays.  The following arrays will be written
into the <tt class="docutils literal"><span class="pre">data</span></tt> and <tt class="docutils literal"><span class="pre">model</span></tt> sub-group for each dataset. The arrays
will be created using the Path Parameters used in the most recent fit
and the Feffit Transform group.  Many of these arrays have names
following the conventions for <a class="reference internal" href="xafsft.html#_xafs.xftf" title="_xafs.xftf"><tt class="xref py py-func docutils literal"><span class="pre">xftf()</span></tt></a> in section on <a class="reference internal" href="xafsft.html#xafs-ft-sec"><em>Fourier
Transforms for XAFS</em></a>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">array name</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>k</td>
<td>wavenumber array of <img class="math" src="../_images/math/8c325612684d41304b9751c175df7bcc0f61f64f.png" alt="k"/>.</td>
</tr>
<tr class="row-odd"><td>chi</td>
<td><img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/>.</td>
</tr>
<tr class="row-even"><td>kwin</td>
<td>window <img class="math" src="../_images/math/96353c36e52c43ad8175ee469239c4e6fcbe8230.png" alt="\Omega(k)"/> (length of input chi(k)).</td>
</tr>
<tr class="row-odd"><td>r</td>
<td>uniform array of <img class="math" src="../_images/math/eff43e84f8a3bcf7b6965f0a3248bc4d3a9d0cd4.png" alt="R"/>, out to <tt class="docutils literal"><span class="pre">rmax_out</span></tt>.</td>
</tr>
<tr class="row-even"><td>chir</td>
<td>complex array of <img class="math" src="../_images/math/addf6166115ffd93feb8be6dc7a575e5e6131611.png" alt="\tilde\chi(R)"/>.</td>
</tr>
<tr class="row-odd"><td>chir_mag</td>
<td>magnitude of <img class="math" src="../_images/math/addf6166115ffd93feb8be6dc7a575e5e6131611.png" alt="\tilde\chi(R)"/>.</td>
</tr>
<tr class="row-even"><td>chir_pha</td>
<td>phase of <img class="math" src="../_images/math/addf6166115ffd93feb8be6dc7a575e5e6131611.png" alt="\tilde\chi(R)"/>.</td>
</tr>
<tr class="row-odd"><td>chir_re</td>
<td>real part of of <img class="math" src="../_images/math/addf6166115ffd93feb8be6dc7a575e5e6131611.png" alt="\tilde\chi(R)"/>.</td>
</tr>
<tr class="row-even"><td>chir_im</td>
<td>imaginary part of <img class="math" src="../_images/math/addf6166115ffd93feb8be6dc7a575e5e6131611.png" alt="\tilde\chi(R)"/>.</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="feffit-report">
<h2><a class="reference internal" href="#_xafs.feffit_report" title="_xafs.feffit_report"><tt class="xref py py-func docutils literal"><span class="pre">feffit_report()</span></tt></a><a class="headerlink" href="#feffit-report" title="Permalink to this headline">Â¶</a></h2>
<dl class="function">
<dt id="_xafs.feffit_report">
<tt class="descclassname">_xafs.</tt><tt class="descname">feffit_report</tt><big>(</big><em>fit_result</em><big>)</big><a class="headerlink" href="#_xafs.feffit_report" title="Permalink to this definition">Â¶</a></dt>
<dd><p>return a printable report from a Feffit fit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fit_result</strong> &#8211; output group from <a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a>.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="example-1-simple-fit-with-1-path">
<h2>Example 1: Simple fit with 1 Path<a class="headerlink" href="#example-1-simple-fit-with-1-path" title="Permalink to this headline">Â¶</a></h2>
<p>We start with a fairly minimal example, fitting spectra read from a data
file with a single Feff Path.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## examples/feffit/doc_feffit1.lar</span>

<span class="c"># read data</span>
<span class="n">cu_data</span> <span class="o">=</span> <span class="n">read_ascii</span><span class="p">(</span><span class="s">&#39;cu.chi&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="s">&#39;k, chi&#39;</span><span class="p">)</span>

<span class="c"># define fitting parameter group</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">amp</span>    <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
             <span class="n">del_e0</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mf">0.1</span><span class="p">),</span>
             <span class="n">sig2</span>   <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
             <span class="n">del_r</span>  <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span> <span class="p">)</span>

<span class="c"># define a Feff Path, give expressions for Path Parameters</span>
<span class="n">path1</span> <span class="o">=</span> <span class="n">feffpath</span><span class="p">(</span><span class="s">&#39;feffcu01.dat&#39;</span><span class="p">,</span>
                 <span class="n">s02</span>    <span class="o">=</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span>
                 <span class="n">e0</span>     <span class="o">=</span> <span class="s">&#39;del_e0&#39;</span><span class="p">,</span>
                 <span class="n">sigma2</span> <span class="o">=</span> <span class="s">&#39;sig2&#39;</span><span class="p">,</span>
                 <span class="n">deltar</span> <span class="o">=</span> <span class="s">&#39;del_r&#39;</span><span class="p">)</span>

<span class="c"># set tranform / fit ranges</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">feffit_transform</span><span class="p">(</span><span class="n">kmin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">kmax</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dk</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s">&#39;kaiser&#39;</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>

<span class="c"># define dataset to include data, pathlist, transform</span>
<span class="n">dset</span>  <span class="o">=</span> <span class="n">feffit_dataset</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cu_data</span><span class="p">,</span> <span class="n">pathlist</span><span class="o">=</span><span class="p">[</span><span class="n">path1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>

<span class="c"># perform fit!</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">feffit</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">dset</span><span class="p">)</span>

<span class="k">print</span> <span class="n">feffit_report</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>  <span class="n">dset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chi</span> <span class="o">*</span><span class="n">dset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
     <span class="n">xlabel</span><span class="o">=</span><span class="s">r&#39;$k \rm\,(\AA^{-1})$&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
     <span class="n">ylabel</span><span class="o">=</span><span class="s">r&#39;$k^2\chi(k) \rm\,(\AA^{-2})$&#39;</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s">&#39;First shell fit to Cu&#39;</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chi</span><span class="o">*</span><span class="n">dset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;fit&#39;</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>  <span class="n">dset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chir_mag</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
     <span class="n">xlabel</span><span class="o">=</span><span class="s">r&#39;$R \rm\,(\AA)$&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
     <span class="n">ylabel</span><span class="o">=</span><span class="s">r&#39;$|\chi(R)| \rm\,(\AA^{-3})$&#39;</span><span class="p">,</span>
     <span class="n">title</span><span class="o">=</span><span class="s">&#39;First shell fit to Cu&#39;</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chir_mag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;fit&#39;</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c">## end examples/feffit/doc_feffit1.lar</span>
</pre></div>
</div>
<p>This simply follows the essential steps:</p>
<blockquote>
<div><p>1. A group of parameters <tt class="docutils literal"><span class="pre">pars</span></tt> is defined.  Note that you can include
upper and/or lower bounds and mix the use of <a class="reference internal" href="../fitting/parameters.html#_math.guess" title="_math.guess"><tt class="xref py py-func docutils literal"><span class="pre">_math.guess()</span></tt></a> and
<a class="reference internal" href="../fitting/parameters.html#_math.param" title="_math.param"><tt class="xref py py-func docutils literal"><span class="pre">_math.param()</span></tt></a>.</p>
<p>2. A Feff Path is defined with <a class="reference internal" href="feffpaths.html#_xafs.feffpath" title="_xafs.feffpath"><tt class="xref py py-func docutils literal"><span class="pre">feffpath()</span></tt></a>, as discussed in the
previous section. Here we assign each of the Path Parameters to the name
of one of the fitting parameters.  More complex expressions and relations
can be used, but for this example, we&#8217;re keeping it simple.</p>
<p>3. A Feffit Transform is created with <a class="reference internal" href="#_xafs.feffit_transform" title="_xafs.feffit_transform"><tt class="xref py py-func docutils literal"><span class="pre">feffit_transform()</span></tt></a>, which
essentially sets the Fourier transform parameters and fit ranges.</p>
<p>4. A Feffit Dataset is created with <a class="reference internal" href="#_xafs.feffit_dataset" title="_xafs.feffit_dataset"><tt class="xref py py-func docutils literal"><span class="pre">feffit_dataset()</span></tt></a>.  To begin the
fit, this includes a <tt class="docutils literal"><span class="pre">data</span></tt> group, a <tt class="docutils literal"><span class="pre">transform</span></tt> group, and a
<tt class="docutils literal"><span class="pre">pathlist</span></tt>,  which is a list of FeffPaths.</p>
<p>5. The fit is run with <a class="reference internal" href="#_xafs.feffit" title="_xafs.feffit"><tt class="xref py py-func docutils literal"><span class="pre">feffit()</span></tt></a>, and the output group is saved.
This output group is used by <a class="reference internal" href="#_xafs.feffit_report" title="_xafs.feffit_report"><tt class="xref py py-func docutils literal"><span class="pre">feffit_report()</span></tt></a> to generate a fit
report (shown below).</p>
<p>6. Plots are made from the dataset, using rather long-winded <tt class="xref py py-func docutils literal"><span class="pre">plot()</span></tt>
commands.</p>
</div></blockquote>
<p>running this example prints out the following report:</p>
<div class="highlight-python"><pre>=================== FEFFIT RESULTS ====================
[[Statistics]]
   npts, nvarys       = 106, 4
   nfree, nfcn_calls  = 102, 31
   chi_square         = 5067.945057
   reduced chi_square = 49.685736

[[Data]]
   n_independent      = 14.260
   eps_k, eps_r       = 0.000180, 0.008540
   fit space          = r
   r-range            = 1.400, 3.000
   k-range            = 3.000, 17.000
   k window, dk       = kaiser, 4.000
   k-weight           = 2
   paths used in fit  = ['feffcu01.dat']

[[Variables]]
   amp            =  0.934846 +/- 0.097346   (init=  1.000000)
   del_e0         =  3.861892 +/- 1.269075   (init=  0.100000)
   del_r          = -0.006031 +/- 0.006476   (init=  0.000000)
   sig2           =  0.008698 +/- 0.000762   (init=  0.002000)

[[Correlations]]    (unreported correlations are &lt;  0.100)
   amp, sig2            =  0.928
   del_e0, del_r        =  0.920
   del_r, sig2          =  0.159
   amp, del_r           =  0.138

[[Paths]]
   feff.dat file = feffcu01.dat
          Atom     x        y        z     ipot
           Cu    0.0000,  0.0000,  0.0000  0 (absorber)
           Cu    0.0000, -1.8016,  1.8016  1
     reff   =  2.54780
     Degen  =  12.00000
     S02    =  0.93485 +/-  0.09735
     E0     =  3.86189 +/-  1.26908
     R      =  2.54177 +/-  0.00648
     deltar = -0.00603 +/-  0.00648
     sigma2 =  0.00870 +/-  0.00076

=======================================================</pre>
</div>
<p>and generates the plots shown below</p>
<blockquote id="xafs-fig12">
<div><a class="reference external image-reference" href="../_images/feffit_example1.png"><img alt="../_images/feffit_example1.png" src="../_images/feffit_example1.png" style="width: 48%;" /></a>
<a class="reference external image-reference" href="../_images/feffit_example2.png"><img alt="../_images/feffit_example2.png" src="../_images/feffit_example2.png" style="width: 48%;" /></a>
<p>Figure 12. Results for Feffit for a simple 1-shell fit to a
spectrum from Cu metal.</p>
</div></blockquote>
<p>This is a pretty good fit to the first shell of Cu metal, and shows the
basic mechanics of fitting XAFS data to Feff Paths.  There are several
things that might be added to this for modeling more complex XAFS data,
including adding more paths to a fit, including multiple-scattering paths,
simultaneously modeling more than one data set, and building more complex
fitting models.  We&#8217;ll get to these in the following examples.</p>
<p>But first, a small detour.  The plotting commands in the above example for
plotting <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/> and <img class="math" src="../_images/math/ed15c000bb99f0b4fabad9eb23e2d7089bc35895.png" alt="\chi(R)"/> for data and model will be
useful for the other examples as well, so we&#8217;ll create a slightly
generalized function to make such plots and put this and several other
plotting functions into a separate file, <em>doc_macros.lar</em>.  This will look
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## examples/feffit/doc_macros.lar</span>
<span class="c">## general purpose macros, mostly for showing XAFS data</span>
<span class="c">##</span>
<span class="n">label_k</span>     <span class="o">=</span> <span class="s">r&#39;$k \rm\,(\AA^{-1})$&#39;</span>
<span class="n">label_r</span>     <span class="o">=</span> <span class="s">r&#39;$R \rm\,(\AA)$&#39;</span>
<span class="n">label_chikw</span> <span class="o">=</span> <span class="s">r&#39;$k^2\chi(k) \rm\,(\AA^{-</span><span class="si">%i</span><span class="s">})$&#39;</span>
<span class="n">label_chir</span>  <span class="o">=</span> <span class="s">r&#39;$|\chi(R)| \rm\,(\AA^{-</span><span class="si">%i</span><span class="s">})$&#39;</span>
<span class="n">label_chirre</span>  <span class="o">=</span> <span class="s">r&#39;${\rm Re}[\chi(R)] \rm\,(\AA^{-</span><span class="si">%i</span><span class="s">})$&#39;</span>
<span class="n">label_chirim</span>  <span class="o">=</span> <span class="s">r&#39;${\rm Im}[\chi(R)] \rm\,(\AA^{-</span><span class="si">%i</span><span class="s">})$&#39;</span>
<span class="n">label_chirpha</span> <span class="o">=</span> <span class="s">r&#39;${\rm Phase}[\chi(R)] \rm\,(\AA^{-</span><span class="si">%i</span><span class="s">})$&#39;</span>
<span class="k">def</span> <span class="nf">plot_chifit</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">kweight</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">title</span><span class="o">=</span><span class="s">&#39;Data and Best-Fit&#39;</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;show chi(k) and chi(r) data and best-fit for a dataset&quot;&quot;&quot;</span>
    <span class="c"># make k-weighted chi(k)</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kweight</span><span class="p">)</span>
    <span class="n">data_chi_kw</span>  <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chi</span> <span class="o">*</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">**</span><span class="n">kw</span>
    <span class="n">model_chi_kw</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chi</span> <span class="o">*</span> <span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="o">**</span><span class="n">kw</span>

    <span class="c"># show k-weighted chi(k) in plot window 1</span>
    <span class="n">newplot</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">data_chi_kw</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">label_k</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">label_chikw</span> <span class="o">%</span> <span class="n">kw</span><span class="p">,</span>
            <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>     <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">model_chi_kw</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s">&#39;fit&#39;</span><span class="p">,</span>  <span class="n">win</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># show chi(R) in plot window 2</span>
    <span class="n">newplot</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>  <span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chir_mag</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">rmax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">label_r</span><span class="p">,</span>  <span class="n">ylabel</span><span class="o">=</span><span class="n">label_chir</span> <span class="o">%</span> <span class="p">(</span><span class="n">kw</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>              <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chir_mag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s">&#39;fit&#39;</span><span class="p">,</span>  <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chir_re</span><span class="p">,</span>   <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>     <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chir_re</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>     <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">enddef</span>


<span class="k">def</span> <span class="nf">plot_path_k</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ipath</span><span class="p">,</span> <span class="n">kweight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="s">&quot;plot k-weighted chi(k) for a particular path in a dataset&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">pathlist</span><span class="p">[</span><span class="n">ipath</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;path </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ipath</span><span class="p">)</span>
    <span class="n">endif</span>
    <span class="k">if</span> <span class="n">kweight</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">kweight</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">kweight</span>
    <span class="n">endif</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kweight</span><span class="p">)</span>
    <span class="n">chi_kw</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">path</span><span class="o">.</span><span class="n">chi</span> <span class="o">*</span> <span class="n">path</span><span class="o">.</span><span class="n">k</span><span class="o">**</span><span class="n">kw</span>

    <span class="n">plot</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">chi_kw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> 
        <span class="n">xlabel</span><span class="o">=</span><span class="n">label_k</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">label_chikw</span> <span class="o">%</span> <span class="n">kw</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>

<span class="n">enddef</span>

<span class="k">def</span> <span class="nf">plot_path_r</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ipath</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="s">&#39;mag&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="s">&quot;plot chi(r) for a particular path in a dataset&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">pathlist</span><span class="p">[</span><span class="n">ipath</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;path </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ipath</span><span class="p">)</span>
    <span class="n">endif</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">kweight</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s">&#39;re&#39;</span><span class="p">:</span>
        <span class="n">chir</span><span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">chir_re</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chirre</span> <span class="o">%</span> <span class="n">kw</span>
    <span class="k">elif</span> <span class="n">comp</span> <span class="o">==</span> <span class="s">&#39;im&#39;</span><span class="p">:</span>
        <span class="n">chir</span><span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">chir_im</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chirim</span> <span class="o">%</span> <span class="n">kw</span>   
    <span class="k">elif</span> <span class="n">comp</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">chir</span><span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">chir_pha</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chirpha</span> <span class="o">%</span> <span class="n">kw</span>       
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">chir_mag</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chir</span> <span class="o">%</span> <span class="n">kw</span>
    <span class="n">endif</span>

    <span class="n">chir</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">chir</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">chir</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">label_r</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>

<span class="n">enddef</span>

<span class="k">def</span> <span class="nf">plot_modelpaths_k</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">kweight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Model and Paths&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;show chi(k) for sum and individual paths&quot;&quot;&quot;</span>
    <span class="c"># make k-weighted chi(k)</span>
    <span class="k">if</span> <span class="n">kweight</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">kweight</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">kweight</span>
    <span class="n">endif</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kweight</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">model</span>

    <span class="n">model_chi_kw</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chi</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="o">**</span><span class="n">kw</span>

    <span class="n">newplot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">model_chi_kw</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">label_r</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">label_chikw</span> <span class="o">%</span> <span class="n">kw</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ipath</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">pathlist</span><span class="p">)):</span>
        <span class="n">plot_path_k</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ipath</span><span class="p">,</span> <span class="n">kweight</span><span class="o">=</span><span class="n">kw</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="n">ipath</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span>        
    <span class="n">endfor</span>
<span class="n">enddef</span>

<span class="k">def</span> <span class="nf">plot_modelpaths_r</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="s">&#39;mag&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Model and Paths&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;show chi(r) for sum and individual paths&quot;&quot;&quot;</span>
    <span class="c"># make k-weighted chi(k)</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">kweight</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">model</span>
    <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s">&#39;re&#39;</span><span class="p">:</span>
        <span class="n">chir</span><span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chir_re</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chirre</span> <span class="o">%</span> <span class="n">kw</span>
    <span class="k">elif</span> <span class="n">comp</span> <span class="o">==</span> <span class="s">&#39;im&#39;</span><span class="p">:</span>
        <span class="n">chir</span><span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chir_im</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chirim</span> <span class="o">%</span> <span class="n">kw</span>   
    <span class="k">elif</span> <span class="n">comp</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">chir</span><span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chir_pha</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chirpha</span> <span class="o">%</span> <span class="n">kw</span>       
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chir</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chir_mag</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">label_chir</span> <span class="o">%</span> <span class="n">kw</span>
    <span class="n">endif</span>

    <span class="n">newplot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">chir</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">label_r</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ipath</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">pathlist</span><span class="p">)):</span>
        <span class="n">plot_path_r</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ipath</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="n">ipath</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span>
    <span class="n">endfor</span>
<span class="n">enddef</span>


<span class="c">## end of examples/feffit/doc_macros.lar</span>
</pre></div>
</div>
<p>This defines several new plotting functions <tt class="xref py py-func docutils literal"><span class="pre">plot_chifit()</span></tt>,
<tt class="xref py py-func docutils literal"><span class="pre">plot_path_k()</span></tt>, and <tt class="xref py py-func docutils literal"><span class="pre">plot_path_r()</span></tt>, and so on which we&#8217;ll find
useful in later examples.  Using the first of these, we can then replace
the plot commands in the script above with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">run</span><span class="p">(</span><span class="s">&#39;doc_macros.lar&#39;</span><span class="p">)</span>
<span class="n">plot_chifit</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;First shell fit to Cu&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and get reproducible plots without having to copy and paste the same code
fragment everywhere.  We&#8217;ll use this in the examples below.</p>
</div>
<div class="section" id="example-2-fit-1-dataset-with-3-paths">
<h2>Example 2: Fit 1 dataset with 3 Paths<a class="headerlink" href="#example-2-fit-1-dataset-with-3-paths" title="Permalink to this headline">Â¶</a></h2>
<p>We&#8217;ll continue with the Cu data set, and add more paths to model further
shells.  This is fairly straightforward, but in the interest of space,
we&#8217;ll limit the example here to 3 paths to model the first two shells of
copper.  This is a small step, but highlights a main concern with XAFS
analysis that we need to address.  This is the fact that there simply is
not enough freedom in the XAFS signal to measure all the possible
adjustable Path Parameters independently.  Thus we need to be able to apply
constraints to the Path Parameters.</p>
<p>Here, we use two of the most common types of constraints.  First, we apply
the same amplitude reduction factor and the same <img class="math" src="../_images/math/8a52f40afedf1c8727d71b0ad5a7ea0a7119b088.png" alt="E_0"/> shift to all
Paths.  These may seem obvious for this example, but for more complicated
examples, either including shells of mixed species or Feff Paths generated
from different calculation, these become less obvious.</p>
<p>Second, we introduce a scale the change in distance by a singple expansion
factor <img class="math" src="../_images/math/10f32377ac67d94f764f12a15ea987e88c85d3e1.png" alt="\alpha"/> (<tt class="docutils literal"><span class="pre">alpha</span></tt> in the script), and using the builtin
value of half-path distance, <tt class="docutils literal"><span class="pre">reff</span></tt>, and setting <tt class="docutils literal"><span class="pre">deltar</span> <span class="pre">=</span>
<span class="pre">'alpha*reff'</span></tt> for all Paths.  During the calculation of <img class="math" src="../_images/math/bb12e6fe6361a7e793c32820d5b6f2d83e1511d2.png" alt="\chi(k)"/>
for each path that happens in the fitting process, the value of <tt class="docutils literal"><span class="pre">reff</span></tt>
will be updated to the correct value for each path.  Thus, as the value of
<tt class="docutils literal"><span class="pre">alpha</span></tt> varies in the fit, each path will use its proper value for
<tt class="docutils literal"><span class="pre">reff</span></tt>, so that each <tt class="docutils literal"><span class="pre">deltar</span></tt> will be different but not independent.
This ensures that all the path lengths change in a manner consistent with
one another.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## examples/feffit/doc_feffit2.lar</span>

<span class="c"># read data</span>
<span class="n">cu_data</span> <span class="o">=</span> <span class="n">read_ascii</span><span class="p">(</span><span class="s">&#39;cu.chi&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="s">&#39;k, chi&#39;</span><span class="p">)</span>

<span class="c"># define fitting parameter group</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">amp</span>    <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
             <span class="n">del_e0</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mf">0.1</span><span class="p">),</span>
             <span class="n">sig2_1</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="o">.</span><span class="mo">002</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
             <span class="n">sig2_2</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="o">.</span><span class="mo">002</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
             <span class="n">sig2_3</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="o">.</span><span class="mo">002</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
             <span class="n">alpha</span>  <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>

<span class="c"># define 3 Feff Path, give expressions for Path Parameters</span>
<span class="n">path1</span> <span class="o">=</span> <span class="n">feffpath</span><span class="p">(</span><span class="s">&#39;feff0001.dat&#39;</span><span class="p">,</span>     <span class="n">s02</span> <span class="o">=</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="s">&#39;del_e0&#39;</span><span class="p">,</span>
                 <span class="n">sigma2</span> <span class="o">=</span> <span class="s">&#39;sig2_1&#39;</span><span class="p">,</span>  <span class="n">deltar</span>  <span class="o">=</span> <span class="s">&#39;alpha*reff&#39;</span><span class="p">)</span>

<span class="n">path2</span> <span class="o">=</span> <span class="n">feffpath</span><span class="p">(</span><span class="s">&#39;feff0002.dat&#39;</span><span class="p">,</span>     <span class="n">s02</span> <span class="o">=</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="s">&#39;del_e0&#39;</span><span class="p">,</span>
                 <span class="n">sigma2</span> <span class="o">=</span> <span class="s">&#39;sig2_2&#39;</span><span class="p">,</span>  <span class="n">deltar</span>  <span class="o">=</span> <span class="s">&#39;alpha*reff&#39;</span><span class="p">)</span>

<span class="n">path3</span> <span class="o">=</span> <span class="n">feffpath</span><span class="p">(</span><span class="s">&#39;feff0003.dat&#39;</span><span class="p">,</span>     <span class="n">s02</span> <span class="o">=</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="n">e0</span> <span class="o">=</span> <span class="s">&#39;del_e0&#39;</span><span class="p">,</span>
                  <span class="n">sigma2</span> <span class="o">=</span> <span class="s">&#39;sig2_3&#39;</span><span class="p">,</span> <span class="n">deltar</span>  <span class="o">=</span> <span class="s">&#39;alpha*reff&#39;</span><span class="p">)</span>

<span class="n">trans</span> <span class="o">=</span> <span class="n">feffit_transform</span><span class="p">(</span><span class="n">kmin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">kmax</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dk</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s">&#39;kaiser&#39;</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mf">3.4</span><span class="p">)</span>

<span class="c"># define dataset to include data, pathlist, transform</span>
<span class="n">dset</span>  <span class="o">=</span> <span class="n">feffit_dataset</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cu_data</span><span class="p">,</span> <span class="n">pathlist</span><span class="o">=</span><span class="p">[</span><span class="n">path1</span><span class="p">,</span> <span class="n">path2</span><span class="p">,</span> <span class="n">path3</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>


<span class="c"># perform fit!</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">feffit</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">dset</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">feffit_report</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="k">print</span> <span class="n">report</span>
<span class="n">run</span><span class="p">(</span><span class="s">&#39;doc_macros.lar&#39;</span><span class="p">)</span>
<span class="n">plot_chifit</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Three-shell fit to Cu&#39;</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># ## end examples/feffit/doc_feffit2.lar</span>
</pre></div>
</div>
<p>Here we simply create <tt class="docutils literal"><span class="pre">path2</span></tt> and <tt class="docutils literal"><span class="pre">path3</span></tt> using nearly the same parameters
as for <tt class="docutils literal"><span class="pre">path1</span></tt>.   Compared to the previous example, the other changess
are that the  <img class="math" src="../_images/math/eff43e84f8a3bcf7b6965f0a3248bc4d3a9d0cd4.png" alt="R"/> range for the fit has been increased so that the
fit will try to fit the second shell, and that  <tt class="docutils literal"><span class="pre">sigma2</span></tt> is allowed to
vary independently for each path.</p>
<p>The output for this fit is a bit longer, being:</p>
<div class="highlight-python"><pre>=================== FEFFIT RESULTS ====================
[[Statistics]]
   npts, nvarys       = 132, 6
   nfree, nfcn_calls  = 126, 50
   chi_square         = 4312.647261
   reduced chi_square = 34.227359

[[Data]]
   n_independent      = 17.825
   eps_k, eps_r       = 0.000180, 0.008540
   fit space          = r
   r-range            = 1.400, 3.400
   k-range            = 3.000, 17.000
   k window, dk       = kaiser, 4.000
   k-weight           = 2
   paths used in fit  = ['feff0001.dat', 'feff0002.dat', 'feff0003.dat']

[[Variables]]
   alpha          = -0.002436 +/- 0.001754   (init=  0.000000)
   amp            =  0.931861 +/- 0.067134   (init=  1.000000)
   del_e0         =  3.855156 +/- 0.871283   (init=  0.100000)
   sig2_1         =  0.008663 +/- 0.000527   (init=  0.002000)
   sig2_2         =  0.013728 +/- 0.002425   (init=  0.002000)
   sig2_3         =  0.008167 +/- 0.006718   (init=  0.002000)

[[Correlations]]    (unreported correlations are &lt;  0.100)
   amp, sig2_1          =  0.930
   alpha, del_e0        =  0.922
   amp, sig2_3          =  0.249
   sig2_1, sig2_3       =  0.247
   amp, sig2_2          =  0.241
   sig2_1, sig2_2       =  0.225
   alpha, sig2_1        =  0.181
   del_e0, sig2_3       =  0.162
   alpha, amp           =  0.161
   alpha, sig2_3        =  0.146
   del_e0, sig2_2       = -0.123

[[Paths]]
   feff.dat file = feff0001.dat
          Atom     x        y        z     ipot
           Cu    0.0000,  0.0000,  0.0000  0 (absorber)
           Cu    0.0000, -1.8016,  1.8016  1
     reff   =  2.54780
     Degen  =  12.00000
     S02    =  0.93186 +/-  0.06713
     E0     =  3.85516 +/-  0.87128
     R      =  2.54159 +/-  0.00447
     deltar = -0.00621 +/-  0.00447
     sigma2 =  0.00866 +/-  0.00053

   feff.dat file = feff0002.dat
          Atom     x        y        z     ipot
           Cu    0.0000,  0.0000,  0.0000  0 (absorber)
           Cu   -3.6032,  0.0000,  0.0000  1
     reff   =  3.60320
     Degen  =  6.00000
     S02    =  0.93186 +/-  0.06713
     E0     =  3.85516 +/-  0.87128
     R      =  3.59442 +/-  0.00632
     deltar = -0.00878 +/-  0.00632
     sigma2 =  0.01373 +/-  0.00243

   feff.dat file = feff0003.dat
          Atom     x        y        z     ipot
           Cu    0.0000,  0.0000,  0.0000  0 (absorber)
           Cu    1.8016, -1.8016,  0.0000  1
           Cu    1.8016,  0.0000, -1.8016  1
     reff   =  3.82180
     Degen  =  48.00000
     S02    =  0.93186 +/-  0.06713
     E0     =  3.85516 +/-  0.87128
     R      =  3.81249 +/-  0.00670
     deltar = -0.00931 +/-  0.00670
     sigma2 =  0.00817 +/-  0.00672

=======================================================</pre>
</div>
<p>With plots of data and fits as shown below.</p>
<blockquote id="xafs-fig13">
<div><a class="reference external image-reference" href="../_images/feffit_example3.png"><img alt="../_images/feffit_example3.png" src="../_images/feffit_example3.png" style="width: 48%;" /></a>
<a class="reference external image-reference" href="../_images/feffit_example4.png"><img alt="../_images/feffit_example4.png" src="../_images/feffit_example4.png" style="width: 48%;" /></a>
<p>Figure 13. Results for Feffit for a 3-shell fit to a spectrum from Cu
metal, constraining all path distances to expand with a single variable.</p>
</div></blockquote>
<p>Here, we show both the magnitude and real part of <img class="math" src="../_images/math/ed15c000bb99f0b4fabad9eb23e2d7089bc35895.png" alt="\chi(R)"/>.  The fit
to the real part shows excellent agreement over the fit <img class="math" src="../_images/math/eff43e84f8a3bcf7b6965f0a3248bc4d3a9d0cd4.png" alt="R"/> range of
[1.4, 3.4] <img class="math" src="../_images/math/9b6bc87a270fc9c4878d7951a4e075ae7bc02c50.png" alt="\AA"/>.  It is often useful the contributions from the
indvidual paths.  With the macros defined above, this is pretty
straightforward, as we can just do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot_modelpaths_k</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot_modelpaths_r</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="s">&#39;re&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>to generate the following plots of the contributions of the differnt paths:</p>
<blockquote id="xafs-fig14">
<div><a class="reference external image-reference" href="../_images/feffit_example5.png"><img alt="../_images/feffit_example5.png" src="../_images/feffit_example5.png" style="width: 48%;" /></a>
<a class="reference external image-reference" href="../_images/feffit_example6.png"><img alt="../_images/feffit_example6.png" src="../_images/feffit_example6.png" style="width: 48%;" /></a>
<p>Figure 14. Path contributions to full mode for the 3-shell fit to Cu
spectrum.</p>
</div></blockquote>
</div>
<div class="section" id="example-3-fit-3-datasets-with-3-paths-each">
<h2>Example 3: Fit 3 datasets with 3 Paths each<a class="headerlink" href="#example-3-fit-3-datasets-with-3-paths-each" title="Permalink to this headline">Â¶</a></h2>
<p>We&#8217;ll extend the above example by adding two more data sets.  This
highlights another key concept in modeling XAFS data and reducing the
number of freely varying parameters in a fit.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../xray/index.html" title="X-ray Databases"
             >next</a> |</li>
        <li class="right" >
          <a href="feffpaths.html" title="XAFS: Reading and using Feff Paths"
             >previous</a> |</li>
   <li><a href="../contents.html">contents</a>|&nbsp;</li>
   <li><a href="../installation.html">download</a>|&nbsp;</li>
   <li><a href="../tutorial/index.html">tutorial</a>|&nbsp;</li>
   <li><a href="../plotting/index.html">plot</a>|&nbsp;</li>
   <li><a href="../fitting/index.html">fit</a>|&nbsp;</li>
   <li><a href="index.html">XAFS</a>|&nbsp;</li>
   <li><a href="../xray/index.html">Xray Data</a>|&nbsp;</li>
   <li><a href="../xray/xrf.html">XRF</a>|&nbsp;</li>

          <li><a href="index.html" >XAFS Analysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Matthew Newville.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>