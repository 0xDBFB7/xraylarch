
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8.2. XAFS: Pre-edge Subtraction and Normalization &mdash; larch 0.9.29 documentation</title>
    
    <link rel="stylesheet" href="../_static/larchdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.29',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="larch 0.9.29 documentation" href="../index.html" />
    <link rel="up" title="8. XAFS Analysis" href="index.html" />
    <link rel="next" title="8.3. XAFS: Post-edge Background Subtraction" href="autobk.html" />
    <link rel="prev" title="8.1. XAFS Functions: Overview and Naming Conventions" href="utilities.html" />
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({ "TeX": {Macros: {AA : "{\\unicode{x212B}}"}},
			 "HTML-CSS": {scale: 90}});
  </script>

  </head>
  <body role="document">
<div style=" color: #c5daba;  text-align: left; height:65px; padding: 0px">
<table border=1>
  <tr>
    <td width=20%>
	<a href="../index.html">
	 <img src="../_static/larchcones.png" height=60px alt="larchcones"/></a>
    </td>
    <td width=75% padding=0>
      <font size=+2>
	<a href="../index.html" style="color:#772211">
	  Larch: Data Analysis Tools for X-ray Spectroscopy
	</a>
      </font>
    </td>
   </tr></table>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="autobk.html" title="8.3. XAFS: Post-edge Background Subtraction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="utilities.html" title="8.1. XAFS Functions: Overview and Naming Conventions"
             accesskey="P">previous</a> |</li>
   <li>[<a href="../data/index.html">Reading Data</a>|</li>
   <li><a href="../plotting/index.html">Plotting</a>|</li>
   <li><a href="../fitting/index.html">Fitting Data</a>|</li>
   <li><a href="index.html">XAFS Analysis</a>|</li>
   <li><a href="../xray/index.html">Xray Databases</a>|</li>
   <li><a href="../xrf/index.html">XRF Analysis</a>|</li>
   <li><a href="../devel/index.html">Scripting</a>]</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">8. XAFS Analysis</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.2. XAFS: Pre-edge Subtraction and Normalization</a><ul>
<li><a class="reference internal" href="#the-pre-edge-function">8.2.1. The <code class="docutils literal"><span class="pre">pre_edge()</span></code> function</a></li>
<li><a class="reference internal" href="#pre-edge-subtraction-example">8.2.2. Pre-Edge Subtraction Example</a></li>
<li><a class="reference internal" href="#the-mback-algorithm">8.2.3. The MBACK algorithm</a></li>
<li><a class="reference internal" href="#over-absorption-corrections">8.2.4. Over-absorption Corrections</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="utilities.html"
                        title="previous chapter">8.1. XAFS Functions: Overview and Naming Conventions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="autobk.html"
                        title="next chapter">8.3. XAFS: Post-edge Background Subtraction</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/xafs/preedge.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xafs-pre-edge-subtraction-and-normalization">
<h1>8.2. XAFS: Pre-edge Subtraction and Normalization<a class="headerlink" href="#xafs-pre-edge-subtraction-and-normalization" title="Permalink to this headline">¶</a></h1>
<p>After reading in data and constructing <span class="math">\(\mu(E)\)</span>, the principle
pre-processing steps for XAFS analysis are pre-edge subtraction and
normalization.  Reading data and constructing <span class="math">\(\mu(E)\)</span> are handled by
internal larch functions, especially <code class="xref py py-func docutils literal"><span class="pre">read_ascii()</span></code>.  The main
XAFS-specific function for pre-edge subtraction and normalization is
<a class="reference internal" href="#pre_edge" title="pre_edge"><code class="xref py py-func docutils literal"><span class="pre">pre_edge()</span></code></a>.</p>
<div class="section" id="the-pre-edge-function">
<h2>8.2.1. The <a class="reference internal" href="#pre_edge" title="pre_edge"><code class="xref py py-func docutils literal"><span class="pre">pre_edge()</span></code></a> function<a class="headerlink" href="#the-pre-edge-function" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="pre_edge">
<code class="descname">pre_edge</code><span class="sig-paren">(</span><em>energy</em>, <em>mu</em>, <em>group=None</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#pre_edge" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><dl class="docutils">
<dt>Pre-edge subtraction and normalization.  This performs a number of steps:</dt>
<dd><ol class="first last arabic simple">
<li>determine <span class="math">\(E_0\)</span> (if not supplied) from max of deriv(mu)</li>
<li>fit a line of polynomial to the region below the edge</li>
<li>fit a polynomial to the region above the edge</li>
<li>extrapolate the two curves to <span class="math">\(E_0\)</span> to determine the edge jump</li>
</ol>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">param energy:</th><td class="field-body">1-d array of x-ray energies, in eV</td>
</tr>
<tr class="field-even field"><th class="field-name">param mu:</th><td class="field-body">1-d array of <span class="math">\(\mu(E)\)</span></td>
</tr>
<tr class="field-odd field"><th class="field-name">param group:</th><td class="field-body">output group</td>
</tr>
<tr class="field-even field"><th class="field-name">param e0:</th><td class="field-body">edge energy, <span class="math">\(E_0\)</span> in eV.  If None, it will be determined here.</td>
</tr>
<tr class="field-odd field"><th class="field-name">param step:</th><td class="field-body">edge jump.  If None, it will be determined here.</td>
</tr>
<tr class="field-even field"><th class="field-name">param pre1:</th><td class="field-body">low E range (relative to E0) for pre-edge fit</td>
</tr>
<tr class="field-odd field"><th class="field-name">param pre2:</th><td class="field-body">high E range (relative to E0) for pre-edge fit</td>
</tr>
<tr class="field-even field"><th class="field-name">param nvict:</th><td class="field-body">energy exponent to use for pre-edge fit.  See Note below.</td>
</tr>
<tr class="field-odd field"><th class="field-name">param norm1:</th><td class="field-body">low E range (relative to E0) for post-edge fit</td>
</tr>
<tr class="field-even field"><th class="field-name">param norm2:</th><td class="field-body">high E range (relative to E0) for post-edge fit</td>
</tr>
<tr class="field-odd field"><th class="field-name">param nnorm:</th><td class="field-body">number of terms in polynomial (that is, 1+degree) for
post-edge, normalization curve. Default=3 (quadratic)</td>
</tr>
<tr class="field-even field"><th class="field-name">returns:</th><td class="field-body">None.</td>
</tr>
</tbody>
</table>
<p>Follows the First Argument Group convention, using group members named <code class="docutils literal"><span class="pre">energy</span></code> and <code class="docutils literal"><span class="pre">mu</span></code>.
The following data is put into the output group:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">attribute</th>
<th class="head">meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>e0</td>
<td>energy origin</td>
</tr>
<tr class="row-odd"><td>edge_step</td>
<td>edge step</td>
</tr>
<tr class="row-even"><td>norm</td>
<td>normalized mu(E)   (array)</td>
</tr>
<tr class="row-odd"><td>pre_edge</td>
<td>pre-edge curve (array)</td>
</tr>
<tr class="row-even"><td>post_edge</td>
<td>post-edge, normalization curve  (array)</td>
</tr>
<tr class="row-odd"><td>pre_slope</td>
<td>slope of pre-edge line</td>
</tr>
<tr class="row-even"><td>pre_offset</td>
<td>offset of pre-edge line</td>
</tr>
<tr class="row-odd"><td>nvict</td>
<td>value of nvict used</td>
</tr>
<tr class="row-even"><td>nnorm</td>
<td>value of nnorm used</td>
</tr>
<tr class="row-odd"><td>norm_c0</td>
<td>constant of normalization polynomial</td>
</tr>
<tr class="row-even"><td>norm_c1</td>
<td>linear coefficient of normalization polynomial</td>
</tr>
<tr class="row-odd"><td>norm_c2</td>
<td>quadratic coefficient of normalization polynomial</td>
</tr>
<tr class="row-even"><td>norm_c*</td>
<td>higher power coefficients of normalization polynomial</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>Notes:</dt>
<dd>nvict gives an exponent to the energy term for the pre-edge fit.
That is, a line <span class="math">\((m E + b)\)</span> is fit to
<span class="math">\(\mu(E) E^{nvict}\)</span>   over the pr-edge region, E= [E0+pre1, E0+pre2].</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="find_e0">
<code class="descname">find_e0</code><span class="sig-paren">(</span><em>energy</em>, <em>mu=None</em>, <em>group=None</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#find_e0" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine <span class="math">\(E_0\)</span>, the energy threshold of the absorption edge,
from the arrays energy and mu for <span class="math">\(\mu(E)\)</span>.</p>
<p>This finds the point with maximum derivative with some
checks to avoid spurious glitches.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>energy</strong> -- array of x-ray energies, in eV</li>
<li><strong>mu</strong> -- array of <span class="math">\(\mu(E)\)</span></li>
<li><strong>group</strong> -- output group</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Follows the First Argument Group convention, using group members named <code class="docutils literal"><span class="pre">energy</span></code> and <code class="docutils literal"><span class="pre">mu</span></code>.
The value of <code class="docutils literal"><span class="pre">e0</span></code> will be written to the output group.</p>
</dd></dl>

</div>
<div class="section" id="pre-edge-subtraction-example">
<h2>8.2.2. Pre-Edge Subtraction Example<a class="headerlink" href="#pre-edge-subtraction-example" title="Permalink to this headline">¶</a></h2>
<p>A simple example of pre-edge subtraction:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;fe2o3_rt1.xmu&#39;</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">read_ascii</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="s1">&#39;energy mu i0&#39;</span><span class="p">)</span>

<span class="n">pre_edge</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span>

<span class="n">show</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>

<span class="n">newplot</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">dat</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39; $ \mu(E) $ &#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Pre-Edge &#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">dat</span><span class="o">.</span><span class="n">pre_edge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pre-edge line&#39;</span><span class="p">,</span>
     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span> <span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">dat</span><span class="o">.</span><span class="n">post_edge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;normalization line&#39;</span><span class="p">,</span>
     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<p>gives the following results:</p>
<div class="figure align-center" id="id1">
<span id="xafs-fig1"></span><a class="reference external image-reference" href="../_images/xafs_preedge.png"><img alt="../_images/xafs_preedge.png" src="../_images/xafs_preedge.png" style="width: 65%;" /></a>
<p class="caption"><span class="caption-text"><strong>Figure 10.1:</strong> XAFS Pre-edge subtraction.</span></p>
</div>
</div>
<div class="section" id="the-mback-algorithm">
<h2>8.2.3. The MBACK algorithm<a class="headerlink" href="#the-mback-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Larch provides an implementation of the MBACK algorithm of
<span class="citation"><a class="reference internal" href="../biblio.html#citation-weng">Weng, Waldo and Penner-Hahn</a><span> </span><span>[</span><a class="reference internal" href="../biblio.html#citation-weng">22</a><span>]</span></span> with an option of using the modification proposed by
<span class="citation"><a class="reference internal" href="../biblio.html#citation-lee-xiang">Lee, Xiang, Ravel, Kortright and Flanagan</a><span> </span><span>[</span><a class="reference internal" href="../biblio.html#citation-lee-xiang">8</a><span>]</span></span>.  In MBACK, the data are matched to the tabulated
values of the imaginary part of the energy-dependent correction to the
Thompson scattering factor, <span class="math">\(f''(E)\)</span>.  To account for any
instrumental or sample-dependent aspects of the shape of the measured
data, <span class="math">\(\mu_{data}(E)\)</span>, a Legendre polynomial of order <span class="math">\(m\)</span>
centered around the absorption edge is subtracted from the data.  To
account for the sort of highly non-linear pre-edge which often results
from Compton scattering in the measurement window of an
energy-discriminating detector, a complementary error function is
added to the Legendre polynomial.</p>
<p>The form of the normalization function, then, is</p>
<div class="math">
\[\mu_{back}(E) = \left[\sum_0^m C_i(E-E_0)^i\right] + A\cdot\operatorname{erfc}\left((E-E_{em}\right)/\xi)\]</div>
<p>where <span class="math">\(A\)</span>, <span class="math">\(E_{em}\)</span>, and <span class="math">\(\xi\)</span> are the amplitude,
centroid, and width of the complementary error function and <span class="math">\(s\)</span>
is a scaling factor for the measured data.  <span class="math">\(E_{em}\)</span> is
typically the centroid of the emission line for the measured edge.
This results in a function of <span class="math">\(3+m\)</span> variables (a tabulated value
of <span class="math">\(E_{em}\)</span> is used).  The function to be minimized, then is</p>
<div class="math">
\[\frac{1}{n_1} \sum_{1}^{n_1} \left[\mu_{tab}(E) + \mu_{back}(E) + s\cdot\mu_{data}(E)\right]^2 +
\frac{1}{n_2} \sum_{n_1+1}^{N} \left[\mu_{tab}(E) + \mu_{back}(E) + s\cdot\mu_{data}(E)\right]^2\]</div>
<p>To give weight in the fit to the pre-edge region, which typically has
fewer measured points than the post-edge region, the weight is
adjusted by breaking the minimization function into two regions: the
<span class="math">\(n_1\)</span> data points below the absorption edge and the <span class="math">\(n_2\)</span>
data points above the absorption edge.  <span class="math">\(n_1+n_2=N\)</span>, where N is
the total number of data points.</p>
<p>If this is used in publication, a citation should be given to
<span class="citation"><a class="reference internal" href="../biblio.html#citation-weng">Weng, Waldo and Penner-Hahn</a><span> </span><span>[</span><a class="reference internal" href="../biblio.html#citation-weng">22</a><span>]</span></span>.</p>
<dl class="function">
<dt id="mback">
<code class="descname">mback</code><span class="sig-paren">(</span><em>energy</em>, <em>mu</em>, <em>group=None</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#mback" title="Permalink to this definition">¶</a></dt>
<dd><p>Match measured <span class="math">\(\mu(E)\)</span> data to tabulated cross-section data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>energy</strong> -- 1-d array of x-ray energies, in eV</li>
<li><strong>mu</strong> -- 1-d array of <span class="math">\(\mu(E)\)</span></li>
<li><strong>group</strong> -- output group</li>
<li><strong>z</strong> -- the Z number of the absorber</li>
<li><strong>edge</strong> -- the absorption edge, usually 'K' or 'L3'</li>
<li><strong>e0</strong> -- edge energy, <span class="math">\(E_0\)</span> in eV.  If None, the tabulated value is used.</li>
<li><strong>emin</strong> -- the minimum energy to include in the fit.  If None, use first energy point</li>
<li><strong>emax</strong> -- the maximum energy to include in the fit.  If None, use last energy point</li>
<li><strong>whiteline</strong> -- a margin around the edge to exclude from the fit.  If not None, must be a positive integer</li>
<li><strong>leexiang</strong> -- flag for using the use the Lee&amp;Xiang extension [False]</li>
<li><strong>tables</strong> -- 'CL' (Cromer-Liberman) or 'Chantler', ['CL']</li>
<li><strong>fit_erfc</strong> -- if True, fit the amplitude and width of the complementary error function [False]</li>
<li><strong>return_f1</strong> -- if True, put f1 in the output group [False]</li>
<li><strong>pre_edge_kws</strong> -- dictionary containing keyword arguments to pass to <a class="reference internal" href="#pre_edge" title="pre_edge"><code class="xref py py-func docutils literal"><span class="pre">pre_edge()</span></code></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None.</p>
</td>
</tr>
</tbody>
</table>
<p>Follows the First Argument Group convention, using group members named <code class="docutils literal"><span class="pre">energy</span></code> and <code class="docutils literal"><span class="pre">mu</span></code>.
The following data is put into the output group:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">attribute</th>
<th class="head">meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>fpp</td>
<td>matched <span class="math">\(\mu(E)\)</span> data</td>
</tr>
<tr class="row-odd"><td>f2</td>
<td>tabulated <span class="math">\(f''(E)\)</span> data</td>
</tr>
<tr class="row-even"><td>f1</td>
<td>tabulated <span class="math">\(f'(E)\)</span> data (if <code class="docutils literal"><span class="pre">return_f1</span></code> is True)</td>
</tr>
<tr class="row-odd"><td>mback_params</td>
<td>params group for the MBACK minimization function</td>
</tr>
</tbody>
</table>
</div></blockquote>
</dd></dl>

<p>Notes:</p>
<blockquote>
<div><ul class="simple">
<li>The <code class="docutils literal"><span class="pre">whiteline</span></code> parameter is used to exclude the region around the
white line in the data from the fit.  The large spectral weight under
the white line can skew the fit result, particularly in data
measured over a short data range.  The value is eV units.</li>
<li>The <code class="docutils literal"><span class="pre">order</span></code> parameter is the order of the Legendre polynomial.
Data measured over a very short data range are likely best processed
with <code class="docutils literal"><span class="pre">order=2</span></code>.  Extended XAS data are often better processed with
a value of 3 or 4.  The order is enforced to be an integer between 1
and 6.</li>
<li>A call to <a class="reference internal" href="#pre_edge" title="pre_edge"><code class="xref py py-func docutils literal"><span class="pre">pre_edge()</span></code></a> is made if <code class="docutils literal"><span class="pre">e0</span></code> is not supplied.</li>
<li>The option to return <span class="math">\(f'(E)\)</span> is used by <code class="xref py py-func docutils literal"><span class="pre">diffkk()</span></code>.</li>
</ul>
</div></blockquote>
<p>Here is an example of processing XANES data measured over an extended
data range.  This example is the K edge of copper foil, with the
result shown in <a href="#fig-mback-copper">8.4</a>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="n">read_ascii</span><span class="p">(</span><span class="s1">&#39;../xafsdata/cu_10k.xmu&#39;</span><span class="p">)</span>
<span class="n">mback</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">newplot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">f2</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;matched absorption&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f_2$&#39;</span><span class="p">,</span>
        <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">fpp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Copper foil&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id2">
<span id="fig-mback-copper"></span><a class="reference external image-reference" href="../_images/mback_copper.png"><img alt="../_images/mback_copper.png" src="../_images/mback_copper.png" style="width: 65%;" /></a>
<p class="caption"><span class="caption-text"><strong>(a)</strong> Using MBACK to match Cu K edge data measured on a copper foil.</span></p>
</div>
<p>Here is an example of processing XANES data measured over a rather
short data range.  This example is the magnesium silicate mineral
talc, Mg<sub>3</sub>Si<sub>4</sub>O<sub>10</sub>(OH)<sub>2</sub>,
measured at the Si K edge, with the result shown in
<a href="#fig-mback-talc">8.6</a>.  Note that the order of the Legendre polynomial
is set to 2 and that the <code class="docutils literal"><span class="pre">whiteline</span></code> parameter is set to avoid the
large features near the edge.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="n">read_ascii</span><span class="p">(</span><span class="s1">&#39;Talc.xmu&#39;</span><span class="p">)</span>
<span class="n">mback</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">xmu</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">whiteline</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">fit_erfc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">newplot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">f2</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;matched absorption&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f_2$&#39;</span><span class="p">,</span>
        <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">fpp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Talc ($\mathrm</span><span class="si">{Mg}</span><span class="s1">_3\mathrm</span><span class="si">{Si}</span><span class="s1">_4\mathrm</span><span class="si">{O}</span><span class="s1">_</span><span class="si">{10}</span><span class="s1">\mathrm{(OH)}_2$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center" id="id3">
<span id="fig-mback-talc"></span><a class="reference external image-reference" href="../_images/mback_talc.png"><img alt="../_images/mback_talc.png" src="../_images/mback_talc.png" style="width: 65%;" /></a>
<p class="caption"><span class="caption-text"><strong>(c)</strong> Using MBACK to match Si K edge data measured on talc.</span></p>
</div>
</div>
<div class="section" id="over-absorption-corrections">
<h2>8.2.4. Over-absorption Corrections<a class="headerlink" href="#over-absorption-corrections" title="Permalink to this headline">¶</a></h2>
<p>For XAFS data measured in fluorescence, a common problem of
<em>over-absorption</em> in which too much of the total X-ray absorption
coefficient is from the absorbing element.  In such cases, the implicit
assumption in a fluorescence XAFS measurement that the fluorescence
intensity is proportional to the absorption coefficient of the element of
interest breaks down.  This is often referred to as <em>self-absorption</em> in
the older XAFS literature, but the term should be avoided as it is quite a
different effect from self-absorption in X-ray fluorescence analysis.  In
fact, the effect is more like <em>extinction</em> in that the fluorescence
probability approaches a constant, with no XAFS oscillations, as the total
absorption coefficient is dominated by the element of interest.
Over-absorption most stongly effects the XAFS oscillation amplitude, and so
coordination number and mean-square displacement parameters in the EXAFS,
and edge-position and pre-edge peak height for XANES.  Fortunately, the
effect can be corrected for small over-absorption.</p>
<p>For XANES, a common correction method from the FLUO program by D. Haskel
(<span class="citation"><a class="reference internal" href="../biblio.html#citation-fluo">Haskel</a><span> </span><span>[</span><a class="reference internal" href="../biblio.html#citation-fluo">6</a><span>]</span></span>) can be used.  The algorithm is contained in the
<a class="reference internal" href="#fluo_corr" title="fluo_corr"><code class="xref py py-func docutils literal"><span class="pre">fluo_corr()</span></code></a> function.</p>
<dl class="function">
<dt id="fluo_corr">
<code class="descname">fluo_corr</code><span class="sig-paren">(</span><em>energy</em>, <em>mu</em>, <em>formula</em>, <em>elem</em>, <em>group=None</em>, <em>edge='K'</em>, <em>anginp=45</em>, <em>angout=45</em>, <em>**pre_kws</em><span class="sig-paren">)</span><a class="headerlink" href="#fluo_corr" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate <span class="math">\(\mu(E)\)</span> corrected for over-absorption in fluorescence
XAFS using the FLUO algorithm (suitabe for XANES, but questionable for
EXAFS).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>energy</strong> -- 1-d array of x-ray energies, in eV</li>
<li><strong>mu</strong> -- 1-d array of <span class="math">\(\mu(E)\)</span></li>
<li><strong>formula</strong> -- string for sample stoichiometry</li>
<li><strong>group</strong> -- output group</li>
<li><strong>elem</strong> -- atomic symbol ('Zn') or Z of absorbing element</li>
<li><strong>edge</strong> -- name of edge ('K', 'L3', ...) [default 'K']</li>
<li><strong>anginp</strong> -- input angle in degrees  [default 45]</li>
<li><strong>angout</strong> -- output angle in degrees [default 45]</li>
<li><strong>pre_kws</strong> -- additional keywords for <a class="reference internal" href="#pre_edge" title="pre_edge"><code class="xref py py-func docutils literal"><span class="pre">pre_edge()</span></code></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
<p>Follows the First Argument Group convention, using group members named
<code class="docutils literal"><span class="pre">energy</span></code> and <code class="docutils literal"><span class="pre">mu</span></code>.  The value of <code class="docutils literal"><span class="pre">mu_corr</span></code> and <code class="docutils literal"><span class="pre">norm_corr</span></code> will
be written to the output group, containing <span class="math">\(\mu(E)\)</span> and
normalized <span class="math">\(\mu(E)\)</span> corrected for over-absorption.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="autobk.html" title="8.3. XAFS: Post-edge Background Subtraction"
             >next</a> |</li>
        <li class="right" >
          <a href="utilities.html" title="8.1. XAFS Functions: Overview and Naming Conventions"
             >previous</a> |</li>
   <li>[<a href="../data/index.html">Reading Data</a>|</li>
   <li><a href="../plotting/index.html">Plotting</a>|</li>
   <li><a href="../fitting/index.html">Fitting Data</a>|</li>
   <li><a href="index.html">XAFS Analysis</a>|</li>
   <li><a href="../xray/index.html">Xray Databases</a>|</li>
   <li><a href="../xrf/index.html">XRF Analysis</a>|</li>
   <li><a href="../devel/index.html">Scripting</a>]</li>

          <li class="nav-item nav-item-1"><a href="index.html" >8. XAFS Analysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright Matthew Newville, The University of Chicago, 2012.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>