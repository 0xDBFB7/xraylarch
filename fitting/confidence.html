<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Advanced Confidence Intervals and Chi-square maps &mdash; larch 0.9.21 documentation</title>
    
    <link rel="stylesheet" href="../_static/larchdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.21',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="top" title="larch 0.9.21 documentation" href="../index.html" />
    <link rel="up" title="Fitting and Modeling Data" href="index.html" />
    <link rel="next" title="XAFS Analysis" href="../xafs/index.html" />
    <link rel="prev" title="Simplified Peak Fitting with fit_peak()" href="fitpeaks.html" /> 
  </head>
  <body>
<div style=" color: #c5daba;  text-align: left; height:100px; padding: 0px">
<table><tr><td width=0></td>
  <td width=25% padding=0>
    <a href="../index.html">
       <img src="../_static/larchcones.png" height=90px alt="larchcones"/>
    </a>
  </td><td width=75% padding=0>
      <font size=+4><a href="../index.html" style="color: #772211">
          Larch: X-ray Data Analysis   </a></font>
</td></tr></table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../xafs/index.html" title="XAFS Analysis"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fitpeaks.html" title="Simplified Peak Fitting with fit_peak()"
             accesskey="P">previous</a> |</li>
   <li><a href="../contents.html">contents</a>|&nbsp;</li>
   <li><a href="../downloads/index.html">downloads</a>|&nbsp;</li>
   <li><a href="../tutorial/index.html">tutorial</a>|&nbsp;</li>
   <li><a href="../data/index.html">data</a>|&nbsp;</li>
   <li><a href="../plotting/index.html">plot</a>|&nbsp;</li>
   <li><a href="index.html">fit</a>|&nbsp;</li>
   <li><a href="../xafs/index.html">XAFS</a>|&nbsp;</li>
   <li><a href="../xray/index.html">Xray Data</a>|&nbsp;</li>
   <li><a href="../xrf/index.html">XRF</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Fitting and Modeling Data</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced Confidence Intervals and Chi-square maps</a><ul>
<li><a class="reference internal" href="#confidence-interval-example-1">Confidence interval, Example 1</a></li>
<li><a class="reference internal" href="#confidence-interval-example-2">Confidence interval, Example 2</a></li>
<li><a class="reference internal" href="#chi-square-maps">Chi-square Maps</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="fitpeaks.html"
                        title="previous chapter">Simplified Peak Fitting with <tt class="docutils literal"><span class="pre">fit_peak()</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../xafs/index.html"
                        title="next chapter">XAFS Analysis</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/fitting/confidence.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="advanced-confidence-intervals-and-chi-square-maps">
<h1>Advanced Confidence Intervals and Chi-square maps<a class="headerlink" href="#advanced-confidence-intervals-and-chi-square-maps" title="Permalink to this headline">¶</a></h1>
<p>Having good estimates for uncertainties in fitted parameters is important
for any scientific analysis.  One of principle attractions to using the
Levenberg-Marquardt algorithm that is the default fitting mechanism with
the <tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt> function is that it will automatically calculate
estimates of parameter uncertainties and correlations.  This is very
convenient and generally reliable, but it should be made clear that the
basic assumptions made when these uncertainties are estimated are not
always perfect.  Unfortunately, it is sometimes difficult to tell when this
is the case.</p>
<p>It is therefore fairly common to see analyses that include explicit
exploration of Parameter values away from their best-fit solution, in order
to determine the degree of confidence in the best-fit values. Larch
provides two main functions to help explore such cases.  To be sure, they
are much slower than the automatic estimation of the uncertainties.  For
many (perhaps most) cases, they do not provide much better insight than the
automatic method.</p>
<dl class="function">
<dt id="confidence_intervals">
<tt class="descname">confidence_intervals</tt><big>(</big><em>minimizer</em>, <em>sigmas=(1</em>, <em>2</em>, <em>3)</em>, <em>prob_func=None</em>, <em>maxiter=200</em><big>)</big><a class="headerlink" href="#confidence_intervals" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate confidence intervals for the parameters from a given fit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>minimizer</strong> &#8211; the minimizer object returned by <tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt>.</li>
<li><strong>sigmas</strong> &#8211; list of sigma-levels to find parameter values for.</li>
<li><strong>prob_func</strong> &#8211; <tt class="docutils literal"><span class="pre">None</span></tt> or callable function to calculate the
probability from the optimized chi-square. By default,
<tt class="xref py py-func docutils literal"><span class="pre">f_compare()</span></tt>, the standard F-test, is used.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a dictionary of parameter names, with each value containing
a list of (sigma, value) pairs.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This function will adjust the value for each parameter, re-optimizing the
other parameters until it finds the parameter values that increase sigma by
the levels indicated.</p>
<dl class="function">
<dt id="confidence_report">
<tt class="descname">confidence_report</tt><big>(</big><em>conf_values</em><big>)</big><a class="headerlink" href="#confidence_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the output of <a class="reference internal" href="#confidence_intervals" title="confidence_intervals"><tt class="xref py py-func docutils literal"><span class="pre">confidence_intervals()</span></tt></a> into a printable report.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>conf_values</strong> &#8211; confidence values returned by <a class="reference internal" href="#confidence_intervals" title="confidence_intervals"><tt class="xref py py-func docutils literal"><span class="pre">confidence_intervals()</span></tt></a>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a string containing the report, which can be printed or stored.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="f_test">
<tt class="descname">f_test</tt><big>(</big><em>ndata</em>, <em>nparams</em>, <em>chisquare</em>, <em>chisquare0</em>, <em>nfix=1</em><big>)</big><a class="headerlink" href="#f_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the standard F-test value for the probability that one fit is
better than another.</p>
</dd></dl>

<div class="section" id="confidence-interval-example-1">
<h2>Confidence interval, Example 1<a class="headerlink" href="#confidence-interval-example-1" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s begin with a shortened version of the first example from the previous
section.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## examples/fitting/doc_example_conf1.lar</span>
<span class="c"># create mock data</span>
<span class="n">mdat</span> <span class="o">=</span> <span class="n">group</span><span class="p">()</span>
<span class="n">mdat</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<span class="n">mdat</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">12.0</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">mdat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> \
         <span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">mdat</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.050</span><span class="p">)</span>


<span class="n">params</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">off</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
               <span class="n">amp</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
               <span class="n">cen</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
               <span class="n">wid</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


<span class="c"># define objective function for fit residual</span>
<span class="k">def</span> <span class="nf">resid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">off</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">amp</span> <span class="o">*</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">cen</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">wid</span><span class="p">))</span>
<span class="n">enddef</span>

<span class="c"># perform fit</span>
<span class="n">mout</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mdat</span><span class="p">,))</span>

<span class="c"># print report of parameters, uncertainties</span>
<span class="k">print</span> <span class="n">fit_report</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">confidence_intervals</span><span class="p">(</span><span class="n">mout</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">print</span> <span class="n">confidence_report</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="c">## end of examples/fitting/doc_example_conf1.lar</span>
</pre></div>
</div>
<p>The printed output from <tt class="docutils literal"><span class="pre">fit_report(params)</span></tt> will include this:</p>
<div class="highlight-python"><pre>[[Variables]]
   amp            =  12.129867 +/- 0.124722 (init=  5.000000)
   cen            =  1.476822 +/- 0.017266 (init=  2.000000)
   off            =  0.998814 +/- 0.007131 (init=  0.000000)
   wid            =  2.022301 +/- 0.016938 (init=  1.000000)

[[Correlations]]     (unreported correlations are &lt;  0.100)
   amp, off             = -0.861
   amp, wid             =  0.808
   off, wid             = -0.692
=======================================================</pre>
</div>
<p>while the output from the much more explicit search done in
<a class="reference internal" href="#confidence_intervals" title="confidence_intervals"><tt class="xref py py-func docutils literal"><span class="pre">confidence_intervals()</span></tt></a> and reported by <a class="reference internal" href="#confidence_report" title="confidence_report"><tt class="xref py py-func docutils literal"><span class="pre">confidence_report()</span></tt></a> will be:</p>
<div class="highlight-python"><pre># Confidence Interval Report
# Sigmas:          -3         -2         -1          0          1          2          3
# Percentiles:  -99.730    -95.450    -68.269      0.000     68.269     95.450     99.730
#==========================================================================================
 amp             11.755      11.88     12.005      12.13     12.256     12.385     12.517
    -best      -0.37459   -0.24967   -0.12455          0    0.12604    0.25555    0.38759
 wid             1.9707     1.9885     2.0053     2.0223     2.0395     2.0569     2.0749
    -best     -0.051552  -0.033784  -0.016975          0   0.017156   0.034567   0.052626
 off             0.9766    0.98468     0.9912    0.99881     1.0064     1.0128     1.0209
    -best     -0.022212  -0.014138  -0.0076156          0  0.0075667   0.013987   0.022049
 cen             1.4248     1.4423     1.4596     1.4768     1.4941     1.5113     1.5289
    -best     -0.052057   -0.03452  -0.017248          0   0.017249   0.034524   0.052068</pre>
</div>
<p>The automatic error estimates given from <tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt> are meant to be
1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> uncertainties.   Comparing the two methods we find:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="16%" />
<col width="37%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Best Value</th>
<th class="head">Automatic 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> value</th>
<th class="head">Explicit 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>amp</td>
<td>12.1299</td>
<td>+/- 0.1247</td>
<td>+0.1267, -0.1246</td>
</tr>
<tr class="row-odd"><td>cen</td>
<td>1.4768</td>
<td>+/- 0.0173</td>
<td>+0.0172, -0.0172</td>
</tr>
<tr class="row-even"><td>off</td>
<td>0.9988</td>
<td>+/- 0.0071</td>
<td>+0.0076, -0.0076</td>
</tr>
<tr class="row-odd"><td>cen</td>
<td>2.0223</td>
<td>+/- 0.0169</td>
<td>+0.0172, -0.0170</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>which seems to justify the use of the automated method.  The uncertainties
found from the more thorough exploration shows symmetric uncertainties,
even out to the 3-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> level, and of the 4 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/>
uncertainties, 3 are within 2%, and the worst agreement, for the smallest
uncertainty is within 7%.    It also shows that the scaling of
uncertainties is fairly linear with <img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/>:  the 3-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/>
values are approximately 3 times the 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> values.</p>
</div>
<div class="section" id="confidence-interval-example-2">
<h2>Confidence interval, Example 2<a class="headerlink" href="#confidence-interval-example-2" title="Permalink to this headline">¶</a></h2>
<p>Of course, there are more challenging cases than the one above.  A double
exponential function is one such example, so we start with a fit to mock
data</p>
<div class="highlight-python"><pre>## examples/fitting/doc_example_conf2.lar
#  Shows usage of fitting with non-normal correlation of variables,
#  and confidence intervals.

random.seed(1)
dat = group(x = linspace(0, 10, 101))
dat.y = 3*exp(-dat.x/2) - 5*exp(-dat.x/9) + random.normal(size=len(dat.x), scale=0.05)

fitparams = group(a1 = guess(3.5),
                  a2 = guess(-9.5),
                  t1 = guess(3),
                  t2 = guess(15))

def fit_exp(pars, dat):
    model = pars.a1 * exp(-dat.x / pars.t1) + pars.a2 * exp(-dat.x / pars.t2)
    return model - dat.y
enddef

minout = minimize(fit_exp, fitparams, args=(dat,))
print fit_report(fitparams, min_correl=0)

final = fit_exp(fitparams, dat) + dat.y
newplot (dat.x, dat.y, label='data', marker='o', linewidth=0)
   plot (dat.x, final, label='fit')

## end of examples/fitting/doc_example_conf2.lar
</pre>
</div>
<p>The resulting statistics report with the automated uncertainties is:</p>
<div class="highlight-python"><pre>===================== FIT RESULTS =====================
[[Statistics]]    Fit succeeded,  method = 'leastsq'.
   Message from fit    = Fit succeeded.
   npts, nvarys, nfree = 101, 4, 97
   nfev (func calls)   = 36
   chi_square          = 0.191322
   reduced chi_square  = 0.001972

[[Variables]]
   a1             =  2.828857 +/- 0.149776 (init=  3.500000)
   a2             = -4.819553 +/- 0.159495 (init= -9.500000)
   t1             =  1.878519 +/- 0.100212 (init=  3.000000)
   t2             =  9.270866 +/- 0.309035 (init=  15.000000)

[[Correlations]]     (unreported correlations are &lt;  0.100)
   a2, t2               =  0.991
   a1, a2               = -0.991
   a1, t2               = -0.988
   a2, t1               = -0.968
   t1, t2               = -0.937
   a1, t1               =  0.935
=======================================================</pre>
</div>
<p>You can see that the correlations between <strong>all 6 pairs of variables</strong> is
above 90%.  The resulting plot of the best-fit looks fairly reasonable:</p>
<blockquote id="fit-conf-fig1">
<div><blockquote>
<div>Figure 1.  Fit to double exponential function.</div></blockquote>
<a class="reference external image-reference" href="../_images/fit_example_conf2.png"><img alt="../_images/fit_example_conf2.png" src="../_images/fit_example_conf2.png" style="width: 65%;" /></a>
</div></blockquote>
<p>But now we ask for the more thorough investigation of the confidence
intervals in these parameters with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">conf_int</span> <span class="o">=</span> <span class="n">confidence_intervals</span><span class="p">(</span><span class="n">minout</span><span class="p">)</span>
<span class="k">print</span> <span class="n">confidence_report</span><span class="p">(</span><span class="n">conf_int</span><span class="p">)</span>
</pre></div>
</div>
<p>and the resulting report is:</p>
<div class="highlight-python"><pre># Confidence Interval Report
# Sigmas:          -3         -2         -1          0          1          2          3
# Percentiles:  -99.730    -95.450    -68.269      0.000     68.269     95.450     99.730
#==========================================================================================
 a1              2.4622     2.5704      2.691     2.8289     2.9936     3.1985      3.467
    -best      -0.36665   -0.25842   -0.13785          0    0.16472    0.36968    0.63812
 a2             -5.4926    -5.2111    -4.9945    -4.8196    -4.6726     -4.544     -4.429
    -best      -0.67309   -0.39152   -0.17499          0    0.14698    0.27553    0.39058
 t2              8.2604     8.6221     8.9556     9.2709     9.5761     9.8776     10.182
    -best       -1.0105   -0.64882   -0.31531          0    0.30526    0.60676    0.91132
 t1              1.6107     1.6942     1.7827     1.8785     1.9841     2.1049     2.2456
    -best      -0.26785   -0.18436   -0.09583          0    0.10553    0.22637    0.36709</pre>
</div>
<p>Now can see more asymmetric uncertainty values, specifically that the
-n-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> and +n-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> are different, and don&#8217;t seem to be
linear in n.  Comparing the 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> levels between the automated
and explicit methods as we did above, we now have</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="16%" />
<col width="37%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Best Value</th>
<th class="head">Automatic 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> value</th>
<th class="head">Explicit 1-<img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>a1</td>
<td>2.8289</td>
<td>+/- 0.1498</td>
<td>+0.1647, -0.1379</td>
</tr>
<tr class="row-odd"><td>a2</td>
<td>-4.8196</td>
<td>+/- 0.1595</td>
<td>+0.1470, -0.1750</td>
</tr>
<tr class="row-even"><td>t1</td>
<td>9.2709</td>
<td>+/- 0.1002</td>
<td>+0.1055, -0.0958</td>
</tr>
<tr class="row-odd"><td>t2</td>
<td>1.8785</td>
<td>+/- 0.3090</td>
<td>+0.3053, -0.3153</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In fairness, the automated values don&#8217;t look too bad, given that they
cannot reflect asymmetric uncertainties.  But, like the reported
correlations, the full report above hints at a less than ideal case.</p>
</div>
<div class="section" id="chi-square-maps">
<h2>Chi-square Maps<a class="headerlink" href="#chi-square-maps" title="Permalink to this headline">¶</a></h2>
<p>We can further explore the correlation between pairs of variables by making
and visualizing a map of the chi-square (<img class="math" src="../_images/math/a61c1e51680e27d35d05bebed87d474972fc70bd.png" alt="\chi^2"/>) statistic.  This
can be helpful to determine if the automatically calculated uncertainties
and correlation are reasonable, and to look for pathological cases.  The
<a class="reference internal" href="#chi2_map" title="chi2_map"><tt class="xref py py-func docutils literal"><span class="pre">chi2_map()</span></tt></a> function will calculate a map of <img class="math" src="../_images/math/a61c1e51680e27d35d05bebed87d474972fc70bd.png" alt="\chi^2"/> for a pair
of variable parameters by brute force.</p>
<dl class="function">
<dt id="chi2_map">
<tt class="descname">chi2_map</tt><big>(</big><em>minimizer</em>, <em>xname</em>, <em>yname</em>, <em>nx=11</em>, <em>ny=11</em>, <em>sigmas=5</em>, <em>xrange=None</em>, <em>yrange=None</em><big>)</big><a class="headerlink" href="#chi2_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a chi-square map for two parameters in a fit</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>minimizer</strong> &#8211; the minimizer object returned by <tt class="xref py py-func docutils literal"><span class="pre">minimize()</span></tt>.</li>
<li><strong>xname</strong> &#8211; name of variable for x-axis</li>
<li><strong>yname</strong> &#8211; name of variable for y-axis</li>
<li><strong>nx</strong> &#8211; number of steps in x [11]</li>
<li><strong>ny</strong> &#8211; number of steps in y [11]</li>
<li><strong>sigmas</strong> &#8211; extent of x, y values to calculate, in <img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/></li>
<li><strong>xrange</strong> &#8211; explicit x range of calculations [x.best +/- <tt class="docutils literal"><span class="pre">sigmas</span></tt> * x.stderr]</li>
<li><strong>yrange</strong> &#8211; explicit y range of calculations [y.best +/- <tt class="docutils literal"><span class="pre">sigmas</span></tt> * y.stderr]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a tuple of (x_vals, y_vals, chi2_map)</p>
</td>
</tr>
</tbody>
</table>
<p>The <tt class="docutils literal"><span class="pre">xrange</span></tt> and <tt class="docutils literal"><span class="pre">yrange</span></tt> arguments can be used to fully dictate the x
and y values to use.  By default, the x and y values are automatically
determined from <tt class="docutils literal"><span class="pre">nx</span></tt>, <tt class="docutils literal"><span class="pre">ny</span></tt>, and <tt class="docutils literal"><span class="pre">sigmas</span></tt>, with the <tt class="docutils literal"><span class="pre">sigmas</span></tt> argument
sets how far from the best value to extend the ranges.</p>
</dd></dl>

<p>As an example usage, we return to the first example of the &#8220;well-behaved&#8221;
fit, and run <a class="reference internal" href="#chi2_map" title="chi2_map"><tt class="xref py py-func docutils literal"><span class="pre">chi2_map()</span></tt></a> on a pair of variables with low correlation
and a pair with high correlation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">chi2_ampcen</span> <span class="o">=</span> <span class="n">chi2_map</span><span class="p">(</span><span class="n">mout</span><span class="p">,</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="s">&#39;cen&#39;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">chi2_ampwid</span> <span class="o">=</span> <span class="n">chi2_map</span><span class="p">(</span><span class="n">mout</span><span class="p">,</span> <span class="s">&#39;amp&#39;</span><span class="p">,</span> <span class="s">&#39;wid&#39;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="n">contour</span><span class="p">(</span><span class="n">chi2_ampcen</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Correlation(amp, cen)&#39;</span><span class="p">)</span>
<span class="n">contour</span><span class="p">(</span><span class="n">chi2_ampwid</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Correlation(amp, wid)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>with the resulting Chi-square maps looking like this:</p>
<blockquote id="fitting-fig9">
<div><a class="reference external image-reference" href="../_images/fit_example_conf3a.png"><img alt="../_images/fit_example_conf3a.png" src="../_images/fit_example_conf3a.png" style="width: 48%;" /></a>
<a class="reference external image-reference" href="../_images/fit_example_conf3b.png"><img alt="../_images/fit_example_conf3b.png" src="../_images/fit_example_conf3b.png" style="width: 48%;" /></a>
<p>Figure 9.  Chi-square maps for two pairs of variables for the fit to
Gaussian data.  With the best-fit chi-square value of 0.5134, the
contour map for relatively uncorrelated parameters <em>amp</em> and <em>cen</em> is
shown on the left, while that for the more highlycorrelated parameters
<em>amp</em> and <em>wid</em> is shown on the right.</p>
</div></blockquote>
<p>The circular map for the uncorrelated parameters <em>amp</em> and <em>cen</em>
and the elliptical map for the highly correlated parameters <em>amp</em> and <em>wid</em>
are exactly as would be expected, and what the automated estimate of
uncertainties and correlations assumes.</p>
<p>But now, if we turn to the more pathological case of the double
exponential, we calculate the chi-square maps as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">chi2_map</span><span class="p">(</span><span class="n">minout</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">,</span> <span class="s">&#39;a2&#39;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">chi2_map</span><span class="p">(</span><span class="n">minout</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">,</span> <span class="s">&#39;t1&#39;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">contour</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>        <span class="n">title</span><span class="o">=</span><span class="s">&#39;Correlation(a1, a2)&#39;</span><span class="p">)</span>
<span class="n">contour</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Correlation(a1, t1)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>with the resulting contour plots:</p>
<blockquote id="fitting-fig10">
<div><a class="reference external image-reference" href="../_images/fit_example_conf4a.png"><img alt="../_images/fit_example_conf4a.png" src="../_images/fit_example_conf4a.png" style="width: 48%;" /></a>
<a class="reference external image-reference" href="../_images/fit_example_conf4b.png"><img alt="../_images/fit_example_conf4b.png" src="../_images/fit_example_conf4b.png" style="width: 48%;" /></a>
<p>Figure 10.  Chi-square maps for two pairs of variables for the fit to
Double Exponential.  With the best-fit chi-square value of 0.1913, the
contour map for <em>a1 and *a2</em> is shown on the left, while that for <em>a1</em>
and <em>t2</em> is shown on the right.</p>
</div></blockquote>
<p>Here, the values of chi-square quickly grow very large away from the ideal
fit.  More importantly, the maps are not remotely elliptical.</p>
<p>Finally, it should be emphasized that while all the tests in this section
are informative, they are also fairly slow, re-running the fits many times.
It is probably safe to rely on the automatic calculations of uncertainties
and correlations, and use these methods on occasions of extremely high
correlation, or when nearing a final analysis.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../xafs/index.html" title="XAFS Analysis"
             >next</a> |</li>
        <li class="right" >
          <a href="fitpeaks.html" title="Simplified Peak Fitting with fit_peak()"
             >previous</a> |</li>
   <li><a href="../contents.html">contents</a>|&nbsp;</li>
   <li><a href="../downloads/index.html">downloads</a>|&nbsp;</li>
   <li><a href="../tutorial/index.html">tutorial</a>|&nbsp;</li>
   <li><a href="../data/index.html">data</a>|&nbsp;</li>
   <li><a href="../plotting/index.html">plot</a>|&nbsp;</li>
   <li><a href="index.html">fit</a>|&nbsp;</li>
   <li><a href="../xafs/index.html">XAFS</a>|&nbsp;</li>
   <li><a href="../xray/index.html">Xray Data</a>|&nbsp;</li>
   <li><a href="../xrf/index.html">XRF</a>|&nbsp;</li>

          <li><a href="index.html" >Fitting and Modeling Data</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Matthew Newville, The University of Chicago, 2012.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>